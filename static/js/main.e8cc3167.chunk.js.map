{"version":3,"sources":["components/Header.tsx","../../src/GameProvider.tsx","../../../src/hooks/useGame.ts","../../../src/hooks/useFrame.ts","../../../src/hooks/useWatch.ts","../../src/stitches.config.ts","../../../src/components/List.tsx","../../src/useStore.ts","../../src/EntityList.tsx","../../../src/hooks/useQuery.ts","../../../src/components/Panel.tsx","../../../src/components/Button.tsx","../../../src/components/Menu.tsx","../../src/AddComponentButton.tsx","../../../src/components/Field.tsx","../../../src/hooks/useId.ts","../../../src/fields/NumberField.tsx","../../../src/fields/StringField.tsx","../../../src/fields/AutoField.tsx","../../../src/fields/ComponentField.tsx","../../src/ComponentEditor.tsx","../../src/EntityDetails.tsx","../../../src/hooks/useForceUpdate.ts","../../src/AddEntityButton.tsx","../../src/Editor.tsx","../../src/logger.ts","../../../src/internal/objectPool.ts","../../src/filters.ts","../../src/QueryIterator.ts","../../src/Query.ts","../../src/QueryManager.ts","../../src/ComponentPool.ts","../../src/Component.ts","../../src/ComponentManager.ts","../../src/ids.ts","../../src/IdManager.ts","../../src/Archetype.ts","../../src/ArchetypeManager.ts","../../src/Entity.ts","../../src/ResourceHandle.ts","../../src/Resources.ts","../../src/RemovedList.ts","../../src/Assets.ts","../../src/Game.ts","../../src/System.ts","../../src/Effect.ts","../../src/compose.ts","demos/space/components.ts","demos/common/box2d/components.ts","demos/common/box2d/ContactListener.ts","demos/common/box2d/systems.ts","demos/common/box2d/utils.ts","demos/space/prefabs.ts","demos/space/utils.ts","demos/space/systems.ts","demos/common/input/keyboard.ts","demos/common/input/pointer.ts","demos/space/spaceGame.ts","demos/space/SpaceGameRoot.tsx","pages/HomePage.tsx","theme.ts","App.tsx","reportWebVitals.ts","index.tsx"],"names":["Header","css","theme","padding","space","alignItems","fontFamily","fonts","heading","tokens","colors","$white","$black","$highlight","$glass","$1","$2","$3","$4","$5","$6","$7","$8","$mono","fontWeights","fontSizes","lineHeights","letterSpacings","sizes","borderWidths","$normal","$thick","radii","shadows","zIndices","transitions","breakpoints","md","sm","styled","C","border","ComponentField","s","e","this","count","a","data","IdManager","prototype","get","id","_this","game","cleanups","Player","Component","rotateSpeed","thrustForce","Damageable","__invulnerableTimer","force","vulnerable","health","Math","max","invulnerableFrames","updated","maxHealth","damageFrom","ColliderTag","group","Asteroid","size","variant","floor","random","Bullet","speed","SpriteConfig","path","stroke","dashGap","Sprite","State","element","Transform","x","y","angle","BodyConfig","shape","radius","density","friction","isStatic","restitution","bullet","fixedRotation","angularDamping","linearDamping","sensor","Body","value","Contacts","began","Array","ended","current","ContactsCache","contact","add","Set","WorldConfig","gravity","contactPairCache","WeakMap","ContactListener","entityListeners","subscribe","entityId","listeners","unsubscribe","invokeListeners","event","pair","aData","GetFixtureA","GetUserData","bData","GetFixtureB","aId","bId","selfId","otherId","otherFixture","selfFixture","toFixed","set","getOrCreatePair","delete","cleanupPair","assignBodyConfig","body","config","SetType","b2BodyType","b2_staticBody","b2_dynamicBody","SetLinearDamping","SetFixedRotation","SetAngularDamping","SetUserData","createFixtureDef","p","fix","b2FixtureDef","userData","isSensor","b2PolygonShape","SetAsBox","width","height","b2CircleShape","vertices","b2EdgeShape","v1","v2","segments","rectHeight","c0","c1","c2","c3","arc0","fill","map","_","i","PI","vecScale","cos","sin","arc1","createCapsule","Error","applyFixtures","GetFixtureList","GetNext","DestroyFixture","CreateFixture","systems","compose","makeEffect","components","entity","world","b2World","globals","resolve","contactListener","SetContactListener","remove","bodyConfig","transform","load","b","CreateBody","SetAngle","SetPositionXY","DestroyBody","contactsCache","makeSystem","changed","ent","contacts","length","simulate","then","Step","on","off","pos","GetPosition","update","GetAngle","c","cache","values","push","splice","indexOf","clear","asteroidPaths","asteroidSizes","asteroidPrefab","create","createSVGElement","tagName","document","createElementNS","createSpriteEffect","pathEl","setAttribute","toString","appendChild","sprite","root","removeChild","updateSpriteSystem","transformSpriteSystem","asteroidInitialSpinEffect","SetAngularVelocity","bulletInitialVelocityEffect","forward","ApplyLinearImpulseToCenter","playerMovementSystem","keyboard","immediate","rotation","getKeyPressed","thrust","damageSystem","damageable","tookDamage","other","colliderTag","includes","addDamage","damageCooldownSystem","tickInvulnerability","shootSystem","getKeyDown","console","log","window","bulletId","bulletPrefab","playerDestroySystem","dead","destroy","asteroidDestroySystem","bulletDestroySystem","asteroidRecoilSystem","otherTransform","direction","normal","vecNormalize","GetMass","wrap","v","buffer","gap","round","self","any","wrappedX","wrappedY","keysPressed","keysDown","keysUp","handleKeyDown","ev","key","has","handleKeyUp","getKeyUp","getAllPressedKeys","frame","addEventListener","pointer","_position","_primaryPressed","_primaryDown","_primaryUp","_secondaryPressed","_secondaryDown","_secondaryUp","handlePointerDownEvents","clientX","clientY","type","isPrimary","handlePointerMoveEvent","Game","Object","gameComponents","box2dComponents","box2dSystems","worldPrefab","playerPrefab","spaceGameRoot","spaceGame","SpaceGameRoot","ref","React","el","raf","loop","requestAnimationFrame","step","cancelAnimationFrame","Editor","SCROLL_THRESHOLD","HomePage","useSpring","scrollTop","handleScroll","scrollY","removeEventListener","div","position","left","textAlign","color","gray","zIndex","style","opacity","to","fontSize","section","marginTop","background","text","textInverse","backgroundInverse","control","surface","focusRing","primary","App","base","process","className","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.e8cc3167.chunk.js","sourcesContent":["import * as React from 'react';\n\nexport function Header() {\n  return (\n    <header\n      css={(theme) => ({\n        padding: theme.space[2],\n        alignItems: 'center',\n      })}\n    >\n      <span\n        css={(theme) => ({\n          fontFamily: theme.fonts.heading,\n          padding: theme.space[2],\n        })}\n      >\n        0G\n      </span>\n    </header>\n  );\n}\n","import * as React from 'react';\nexport var gameContext = React.createContext(null);\nexport var GameProvider = gameContext.Provider;\n//# sourceMappingURL=GameProvider.js.map","import { useContext } from 'react';\nimport { gameContext } from '../GameProvider';\nexport function useGame() {\n    var game = useContext(gameContext);\n    if (!game) {\n        throw new Error('Must be called within World');\n    }\n    return game;\n}\n//# sourceMappingURL=useGame.js.map","var __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nimport { useEffect, useLayoutEffect, useRef } from 'react';\nimport { useGame } from './useGame';\n/**\n * Runs a callback every game step\n */\nexport function useFrame(callback) {\n    var game = useGame();\n    var ref = useRef(callback);\n    useLayoutEffect(function () {\n        ref.current = callback;\n    }, [callback]);\n    useEffect(function () {\n        function run() {\n            ref.current();\n        }\n        game.on('step', run);\n        return function () {\n            game.off('step', run);\n        };\n    }, [game, ref]);\n}\n/**\n * Iterates over a query result entity list every\n * game step\n */\nexport function useQueryFrame(input, callback) {\n    useFrame(function () {\n        var e_1, _a;\n        try {\n            for (var input_1 = __values(input), input_1_1 = input_1.next(); !input_1_1.done; input_1_1 = input_1.next()) {\n                var ent = input_1_1.value;\n                // FIXME:\n                callback(ent);\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (input_1_1 && !input_1_1.done && (_a = input_1.return)) _a.call(input_1);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n    });\n}\n//# sourceMappingURL=useFrame.js.map","import { useFrame } from './useFrame';\nimport { useGame } from './useGame';\nexport function useWatch(component, onChange) {\n    var game = useGame();\n    useFrame(function () {\n        if (game.componentManager.wasChangedLastFrame(component.id)) {\n            onChange(component);\n        }\n    });\n}\n//# sourceMappingURL=useWatch.js.map","var _a;\nimport { createStyled } from '@stitches/react';\nexport var styled = (_a = createStyled({\n    // prefix: '0g', // doesn't work\n    tokens: {\n        colors: {\n            $white: '#fff',\n            $black: '#202020',\n            $highlight: '#404040',\n            $glass: 'rgba(32, 32, 32, 0.5)',\n        },\n        space: {\n            $1: '4px',\n            $2: '8px',\n            $3: '12px',\n            $4: '16px',\n            $5: '20px',\n            $6: '24px',\n            $7: '28px',\n            $8: '32px',\n        },\n        fonts: {\n            $mono: 'monospace',\n        },\n        fontWeights: {},\n        fontSizes: {},\n        lineHeights: {},\n        letterSpacings: {},\n        sizes: {},\n        borderWidths: {\n            $normal: '1px',\n            $thick: '2px',\n        },\n        radii: {},\n        shadows: {},\n        zIndices: {},\n        transitions: {},\n    },\n    breakpoints: {\n        md: function (rule) { return \"@media (max-width: 900px) { \" + rule + \" }\"; },\n        sm: function (rule) { return \"@media (max-width: 720px) { \" + rule + \" }\"; },\n    },\n}), _a.styled), css = _a.css;\n//# sourceMappingURL=stitches.config.js.map","import { styled } from '../stitches.config';\nexport var List = styled('ul', {\n    listStyle: 'none',\n    margin: 0,\n    padding: 0,\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'stretch',\n});\nexport var ListItem = styled('li', {\n    padding: '$3',\n    backgroundColor: '$glass',\n    border: \"none\",\n    color: \"$white\",\n    textAlign: 'left',\n    fontFamily: 'inherit',\n    ':focus': {\n        boxShadow: '0 0 0 2px #fff, 0 0 0 4px #202020',\n        outline: 'none',\n        border: 'none',\n    },\n    variants: {\n        state: {\n            default: {},\n            selected: {\n                backgroundColor: '$highlight',\n            },\n        },\n    },\n});\n//# sourceMappingURL=List.js.map","import create from 'zustand';\nimport { combine } from 'zustand/middleware';\nexport var useStore = create(combine({\n    selectedEntityId: null,\n}, function (set, get) { return ({\n    api: {\n        selectEntity: function (id) { return set({ selectedEntityId: id }); },\n    },\n}); }));\n//# sourceMappingURL=useStore.js.map","var __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nimport { useQuery } from '@0g/react';\nimport * as React from 'react';\nimport { List, ListItem } from './components/List';\nimport { useStore } from './useStore';\nimport shallow from 'zustand/shallow';\nexport function EntityList(_a) {\n    var allEntities = useQuery([]);\n    var _b = __read(useStore(function (s) { return [s.selectedEntityId, s.api.selectEntity]; }, shallow), 2), selectedId = _b[0], select = _b[1];\n    return (React.createElement(List, { css: { width: '100%' } }, allEntities.map(function (entityId) { return (React.createElement(ListItem, { as: \"button\", key: entityId, state: entityId === selectedId ? 'selected' : 'default', onClick: function () { return select(entityId); } }, entityId)); })));\n}\n//# sourceMappingURL=EntityList.js.map","var __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nimport { useLayoutEffect, useState } from 'react';\nimport { useGame } from './useGame';\nexport function useQuery(queryDef) {\n    var game = useGame();\n    // stored as a static reference.\n    var _a = __read(useState(function () { return game.queryManager.create(queryDef); }), 1), query = _a[0];\n    var _b = __read(useState(Math.random()), 2), _ = _b[0], setForceUpdate = _b[1];\n    useLayoutEffect(function () {\n        function onEntitiesChanged() {\n            setForceUpdate(Math.random());\n        }\n        query.on('entityAdded', onEntitiesChanged);\n        query.on('entityRemoved', onEntitiesChanged);\n        return function () {\n            query.off('entityAdded', onEntitiesChanged);\n            query.off('entityRemoved', onEntitiesChanged);\n        };\n    }, [query]);\n    return query.entities;\n}\n//# sourceMappingURL=useQuery.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nimport * as React from 'react';\nimport { styled } from '../stitches.config';\nimport { useSpring, animated } from '@react-spring/web';\nimport { DoubleArrowLeftIcon, DoubleArrowRightIcon, Cross1Icon, } from '@modulz/radix-icons';\nexport var PanelSurface = styled('div', {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    right: 0,\n    bottom: 0,\n    pointerEvents: 'none',\n    overflow: 'hidden',\n});\nvar PanelRoot = styled(animated.div, {\n    minWidth: 200,\n    backgroundColor: '$glass',\n    border: \"1px solid $black\",\n    boxShadow: \"inset 0 0 0 1px $white\",\n    position: 'absolute',\n    top: 0,\n    bottom: 0,\n    overflow: 'visible',\n    pointerEvents: 'all',\n    display: 'flex',\n    flexDirection: 'column',\n    padding: '$1',\n});\nvar panelContext = React.createContext(null);\nexport function Panel(_a) {\n    var anchor = _a.anchor, controlledOpen = _a.open, onClose = _a.onClose, rest = __rest(_a, [\"anchor\", \"open\", \"onClose\"]);\n    var _b = __read(React.useState(!!controlledOpen), 2), open = _b[0], setOpen = _b[1];\n    React.useEffect(function () {\n        if (controlledOpen === undefined)\n            return;\n        setOpen(!!controlledOpen);\n    }, [controlledOpen]);\n    var toggle = React.useCallback(function () {\n        setOpen(function (cur) {\n            if (cur)\n                onClose === null || onClose === void 0 ? void 0 : onClose();\n            return !cur;\n        });\n    }, [onClose]);\n    var value = React.useMemo(function () { return ({\n        toggle: toggle,\n        open: open,\n        anchor: anchor,\n    }); }, [toggle, open, anchor]);\n    var style = useSpring({\n        x: anchor === 'left' ? (open ? '0%' : '-100%') : open ? '0%' : '100%',\n        left: anchor === 'left' ? 0 : 'auto',\n        right: anchor === 'left' ? 'auto' : 0,\n    });\n    return (React.createElement(panelContext.Provider, { value: value },\n        React.createElement(PanelRoot, __assign({ style: style }, rest))));\n}\nexport var PanelContent = styled('div', {\n    overflowY: 'auto',\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'flex-start',\n});\nvar PanelToggleButton = styled('button', {\n    border: 'none',\n    borderRadius: '100%',\n    padding: '$1',\n    position: 'absolute',\n    lineHeight: 0,\n    variants: {\n        anchor: {\n            left: {\n                left: 'calc(100% + 8px)',\n            },\n            right: {\n                right: 'calc(100% + 8px)',\n            },\n        },\n    },\n});\nexport function PanelToggle(_a) {\n    var children = _a.children;\n    var ctx = React.useContext(panelContext);\n    if (!ctx)\n        throw new Error('Must be used inside Panel');\n    var toggle = ctx.toggle, anchor = ctx.anchor, open = ctx.open;\n    return (React.createElement(PanelToggleButton, { onClick: toggle, anchor: anchor }, children !== null && children !== void 0 ? children : React.createElement(PanelToggleIcon, { anchor: anchor, open: open })));\n}\nfunction PanelToggleIcon(_a) {\n    var anchor = _a.anchor, open = _a.open;\n    if (anchor === 'left') {\n        if (open) {\n            return React.createElement(Cross1Icon, null);\n        }\n        return React.createElement(DoubleArrowRightIcon, null);\n    }\n    else {\n        if (open) {\n            return React.createElement(Cross1Icon, null);\n        }\n        return React.createElement(DoubleArrowLeftIcon, null);\n    }\n}\nexport var PanelHeader = styled('div', {\n    paddingLeft: '$1',\n    paddingRight: '$1',\n    paddingTop: '$2',\n    paddingBottom: '$2',\n    width: '100%',\n});\n//# sourceMappingURL=Panel.js.map","import { styled } from '../stitches.config';\nexport var Button = styled('button', {\n    backgroundColor: '$white',\n    color: '$black',\n    borderRadius: 8,\n    fontSize: 13,\n    lineHeight: '1',\n    fontWeight: 500,\n    paddingTop: 10,\n    paddingBottom: 10,\n    paddingLeft: 16,\n    paddingRight: 16,\n    border: 0,\n    fontFamily: 'inherit',\n    ':hover': {\n        opacity: 0.9,\n    },\n    ':active': {\n        opacity: 1,\n    },\n    ':focus': {\n        outline: 'none',\n        boxShadow: 'inset 0 0 0 2px #fff, inset 0 0 0 4px #202020',\n    },\n    '& + &': {\n        marginLeft: 8,\n    },\n    variants: {\n        size: {\n            small: {\n                fontSize: 10,\n                paddingTop: 5,\n                paddingBottom: 5,\n                paddingLeft: 8,\n                paddingRight: 8,\n            },\n        },\n    },\n});\n//# sourceMappingURL=Button.js.map","import * as DropdownMenu from '@radix-ui/react-dropdown-menu';\nimport { styled } from '../stitches.config';\nimport { Button } from './Button';\nexport var MenuRoot = styled(DropdownMenu.Root, {});\nexport var MenuTrigger = styled(DropdownMenu.Trigger, {});\nMenuTrigger.defaultProps = {\n    as: Button,\n};\nexport var MenuContent = styled(DropdownMenu.Content, {\n    backgroundColor: '$white',\n    color: '$black',\n    padding: '$1',\n    borderRadius: 4,\n});\nexport var MenuLabel = styled(DropdownMenu.Label, {});\nexport var MenuItem = styled(DropdownMenu.Item, {});\nexport var MenuGroup = styled(DropdownMenu.Group, {});\nexport var MenuArrow = styled(DropdownMenu.Arrow, {\n    fill: '$white',\n});\n//# sourceMappingURL=Menu.js.map","import { useGame } from '@0g/react';\nimport * as React from 'react';\nimport { MenuArrow, MenuContent, MenuItem, MenuLabel, MenuRoot, MenuTrigger, } from './components/Menu';\nexport function AddComponentButton(_a) {\n    var entityId = _a.entityId;\n    var game = useGame();\n    var addComponent = function (C) {\n        game.add(entityId, new C());\n    };\n    return (React.createElement(MenuRoot, null,\n        React.createElement(MenuTrigger, null, \"Add Component\"),\n        React.createElement(MenuContent, null,\n            React.createElement(MenuLabel, null, \"Component Type\"),\n            game.componentManager.componentTypes.map(function (Type) { return (React.createElement(MenuItem, { key: Type.id, onClick: function () { return addComponent(Type); } }, Type.name)); }),\n            React.createElement(MenuArrow, null))));\n}\n//# sourceMappingURL=AddComponentButton.js.map","import { styled } from '../stitches.config';\nexport var Field = styled('div', {\n    display: 'flex',\n    flexDirection: 'column',\n});\nexport var FieldLabel = styled('label', {\n    marginBottom: '$1',\n});\nexport var FieldInput = styled('input', {\n    paddingLeft: '$3',\n    paddingRight: '$3',\n    paddingTop: '$2',\n    paddingBottom: '$2',\n    border: 'none',\n    backgroundColor: '$white',\n    color: '$black',\n    borderRadius: 8,\n    ':focus': {\n        outline: 'none',\n        boxShadow: 'inset 0 0 0 2px #fff, inset 0 0 0 4px #202020',\n    },\n});\nexport var FieldInputGroup = styled('div', {\n    display: 'flex',\n    flexDirection: 'row',\n    '& > *': {\n        flex: '1 0 0',\n    },\n    '& > * + *': {\n        marginLeft: '$1',\n    },\n});\nexport var FieldCurrentValue = styled('span', {\n    overflow: 'hidden',\n    textOverflow: 'ellipsis',\n    fontSize: '0.9em',\n});\n//# sourceMappingURL=Field.js.map","import { useRef } from 'react';\nexport function useId(provided) {\n    var idRef = useRef(provided !== null && provided !== void 0 ? provided : Math.random().toFixed(20).slice(2));\n    return idRef.current;\n}\n//# sourceMappingURL=useId.js.map","import { useWatch } from '@0g/react';\nimport * as React from 'react';\nimport { Field, FieldInput, FieldLabel, FieldInputGroup, FieldCurrentValue, } from '../components/Field';\nimport { useId } from '../hooks/useId';\nexport function NumberField(_a) {\n    var store = _a.store, name = _a.name;\n    var id = useId();\n    var ref = React.useRef(null);\n    var onChange = React.useCallback(function (ev) {\n        store[name] = ev.target.value;\n        store.updated = true;\n    }, [store, name]);\n    useWatch(store, React.useCallback(function () {\n        if (!ref.current)\n            return;\n        ref.current.innerText = store[name];\n    }, [store, name, ref]));\n    return (React.createElement(Field, null,\n        React.createElement(FieldLabel, { htmlFor: id }, name),\n        React.createElement(FieldInputGroup, null,\n            React.createElement(FieldCurrentValue, { ref: ref }),\n            React.createElement(FieldInput, { onBlur: onChange, id: id, type: \"number\" }))));\n}\n//# sourceMappingURL=NumberField.js.map","import * as React from 'react';\nimport { useId } from '../hooks/useId';\nimport { Field, FieldLabel, FieldInput } from '../components/Field';\nimport { useWatch } from '@0g/react';\nexport function StringField(_a) {\n    var store = _a.store, name = _a.name;\n    var id = useId();\n    var ref = React.useRef(null);\n    var onChange = React.useCallback(function (ev) {\n        store[name] = ev.target.value;\n        store.updated = true;\n    }, [store, name]);\n    useWatch(store, React.useCallback(function () {\n        if (!ref.current)\n            return;\n        ref.current.value = store[name];\n    }, [store, name, ref]));\n    return (React.createElement(Field, null,\n        React.createElement(FieldLabel, { htmlFor: id }, name),\n        React.createElement(FieldInput, { ref: ref, onBlur: onChange, id: id })));\n}\n//# sourceMappingURL=StringField.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport * as React from 'react';\nimport { NumberField } from './NumberField';\nimport { StringField } from './StringField';\nfunction getType(store, name) {\n    // get the constructor\n    var Constructor = Object.getPrototypeOf(store).constructor;\n    // default value of the field\n    var defaultValue = Constructor.defaultValues[name];\n    if (typeof defaultValue === 'object') {\n        // differentiate array vs obj\n    }\n    else {\n        switch (typeof defaultValue) {\n            case 'string':\n                return 'string';\n            case 'number':\n                return 'number';\n        }\n    }\n    return null;\n}\nexport function AutoField(props) {\n    // heuristic for deciding which field to render\n    var type = getType(props.store, props.name);\n    switch (type) {\n        case 'string':\n            return React.createElement(StringField, __assign({}, props));\n        case 'number':\n            return React.createElement(NumberField, __assign({}, props));\n        default:\n            return null;\n    }\n}\n//# sourceMappingURL=AutoField.js.map","import * as React from 'react';\nimport { AutoField } from './AutoField';\nexport function ComponentField(_a) {\n    var store = _a.store, name = _a.name;\n    // TODO: custom field specs\n    return React.createElement(AutoField, { store: store, name: name });\n}\n//# sourceMappingURL=ComponentField.js.map","var __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nimport * as React from 'react';\nimport { ComponentField } from './fields/ComponentField';\nfunction extractProps(component) {\n    return Object.entries(Object.getPrototypeOf(component).constructor.defaults);\n}\nexport function ComponentEditor(_a) {\n    var store = _a.component;\n    return (React.createElement(\"div\", null,\n        React.createElement(\"h4\", null, Object.getPrototypeOf(store).constructor.name),\n        extractProps(store).map(function (_a) {\n            var _b = __read(_a, 1), name = _b[0];\n            return (React.createElement(ComponentField, { key: name, store: store, name: name }));\n        })));\n}\n//# sourceMappingURL=ComponentEditor.js.map","var __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nimport { useGame } from '@0g/react';\nimport * as React from 'react';\nimport { AddComponentButton } from './AddComponentButton';\nimport { List, ListItem } from './components/List';\nimport { PanelHeader } from './components/Panel';\nimport { useForceUpdate } from './hooks/useForceUpdate';\nimport { ComponentEditor } from './ComponentEditor';\nimport { useStore } from './useStore';\nexport function EntityDetails(_a) {\n    var update = useForceUpdate();\n    var entityId = useStore(function (s) { return s.selectedEntityId; });\n    var game = useGame();\n    var _b = __read(React.useState(new Array()), 2), components = _b[0], setComponents = _b[1];\n    // rerender if stores change\n    React.useEffect(function () {\n        var _a;\n        if (!entityId)\n            return;\n        var ent = game.get(entityId);\n        setComponents(Array.from((_a = ent === null || ent === void 0 ? void 0 : ent.components.values()) !== null && _a !== void 0 ? _a : []));\n        function onAddComponent(id, component) {\n            if (id !== entityId)\n                return;\n            setComponents(function (cur) {\n                cur[component.__type] = component;\n                return cur;\n            });\n        }\n        function onRemoveComponent(id, componentType) {\n            if (id !== entityId)\n                return;\n            setComponents(function (cur) {\n                delete cur[componentType];\n                return cur;\n            });\n        }\n        game.archetypeManager.on('entityComponentAdded', onAddComponent);\n        game.archetypeManager.on('entityComponentRemoved', onRemoveComponent);\n        return function () {\n            game.archetypeManager.off('entityComponentAdded', onAddComponent);\n            game.archetypeManager.off('entityComponentRemoved', onRemoveComponent);\n        };\n    }, [entityId]);\n    if (!entityId) {\n        return React.createElement(React.Fragment, null, \"No entity\");\n    }\n    return (React.createElement(React.Fragment, { key: entityId },\n        React.createElement(PanelHeader, null,\n            React.createElement(\"h3\", null, entityId),\n            React.createElement(AddComponentButton, { entityId: entityId })),\n        React.createElement(List, { css: { minWidth: 400 } }, components.map(function (comp) {\n            if (!comp)\n                return null;\n            return (React.createElement(ListItem, { key: Object.getPrototypeOf(comp).name },\n                React.createElement(ComponentEditor, { component: comp })));\n        }))));\n}\n//# sourceMappingURL=EntityDetails.js.map","var __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nimport { useCallback, useState } from 'react';\nexport function useForceUpdate() {\n    var _a = __read(useState(Math.random()), 2), _ = _a[0], setNonce = _a[1];\n    return useCallback(function () { return setNonce(Math.random()); }, []);\n}\n//# sourceMappingURL=useForceUpdate.js.map","import { useGame } from '@0g/react';\nimport * as React from 'react';\nimport { Button } from './components/Button';\nimport { useStore } from './useStore';\nexport function AddEntityButton() {\n    var game = useGame();\n    var select = useStore(function (s) { return s.api.selectEntity; });\n    var addEntity = React.useCallback(function () {\n        var e = game.create();\n        select(e);\n    }, [game, select]);\n    return React.createElement(Button, { onClick: addEntity }, \"Add Entity\");\n}\n//# sourceMappingURL=AddEntityButton.js.map","import * as React from 'react';\nimport { GameProvider } from '@0g/react';\nimport { EntityList } from './EntityList';\nimport { Panel, PanelSurface, PanelToggle, PanelContent, PanelHeader, } from './components/Panel';\nimport { EntityDetails } from './EntityDetails';\nimport { AddEntityButton } from './AddEntityButton';\nexport function Editor(_a) {\n    var game = _a.game;\n    return (React.createElement(GameProvider, { value: game },\n        React.createElement(PanelSurface, null,\n            React.createElement(Panel, { anchor: \"left\" },\n                React.createElement(PanelContent, null,\n                    React.createElement(PanelHeader, null,\n                        React.createElement(AddEntityButton, null)),\n                    React.createElement(EntityList, null)),\n                React.createElement(PanelToggle, null)),\n            React.createElement(Panel, { anchor: \"right\" },\n                React.createElement(PanelContent, null,\n                    React.createElement(EntityDetails, null)),\n                React.createElement(PanelToggle, null)))));\n}\n//# sourceMappingURL=Editor.js.map","var __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spread = (this && this.__spread) || function () {\n    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n    return ar;\n};\nvar doLog = function (level) {\n    var messages = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        messages[_i - 1] = arguments[_i];\n    }\n    if (localStorage.getItem('DEBUG') === 'true' || window.DEBUG) {\n        console[level].apply(console, __spread(messages));\n    }\n};\nexport var logger = {\n    info: doLog.bind(null, 'info'),\n    warn: doLog.bind(null, 'warn'),\n    error: doLog.bind(null, 'error'),\n    debug: doLog.bind(null, 'debug'),\n    log: doLog.bind(null, 'log'),\n};\n//# sourceMappingURL=logger.js.map","import { logger } from '../logger';\nvar ObjectPool = /** @class */ (function () {\n    function ObjectPool(factory, initialSize) {\n        if (initialSize === void 0) { initialSize = 1; }\n        this.factory = factory;\n        this.free = new Array();\n        this.count = 0;\n        this.expand(initialSize);\n    }\n    ObjectPool.prototype.acquire = function () {\n        // Grow the list by 20%ish if we're out\n        if (this.free.length <= 0) {\n            this.expand(Math.round(this.count * 0.2) + 1);\n        }\n        var item = this.free.pop();\n        return item;\n    };\n    ObjectPool.prototype.release = function (item) {\n        var _a;\n        if (!item) {\n            logger.warn(\"Tried to release \" + item);\n            return;\n        }\n        (_a = item.reset) === null || _a === void 0 ? void 0 : _a.call(item);\n        this.free.push(item);\n    };\n    ObjectPool.prototype.expand = function (count) {\n        for (var n = 0; n < count; n++) {\n            var clone = this.factory();\n            this.free.push(clone);\n        }\n        this.count += count;\n    };\n    Object.defineProperty(ObjectPool.prototype, \"size\", {\n        get: function () {\n            return this.count;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ObjectPool.prototype, \"freeCount\", {\n        get: function () {\n            return this.free.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ObjectPool.prototype, \"usedCount\", {\n        get: function () {\n            return this.count - this.free.length;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ObjectPool;\n}());\nexport { ObjectPool };\n//# sourceMappingURL=objectPool.js.map","export var has = function (Component) { return ({\n    Component: Component,\n    kind: 'has',\n    __isFilter: true,\n    toString: function () {\n        return \"has(\" + Component.name + \")\";\n    },\n}); };\nexport var not = function (Component) { return ({\n    Component: Component,\n    kind: 'not',\n    __isFilter: true,\n    toString: function () {\n        return \"not(\" + Component.name + \")\";\n    },\n}); };\nexport var changed = function (Component) { return ({\n    Component: Component,\n    kind: 'changed',\n    __isFilter: true,\n    toString: function () {\n        return \"changed(\" + Component.name + \")\";\n    },\n}); };\nexport var any = function () {\n    var Components = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        Components[_i] = arguments[_i];\n    }\n    return ({\n        Components: Components,\n        kind: 'any',\n        __isFilter: true,\n        toString: function () {\n            return \"any(\" + Components.map(function (Comp) { return Comp.name; }).join(', ') + \")\";\n        },\n    });\n};\nexport var isFilter = function (thing) {\n    return thing.__isFilter === true;\n};\nexport var isNotFilter = function (fil) {\n    return fil.kind === 'not';\n};\nexport var isHasFilter = function (fil) {\n    return fil.kind === 'has';\n};\nexport var isChangedFilter = function (fil) { return fil.kind === 'changed'; };\nexport var isAnyFilter = function (fil) { return fil.kind === 'any'; };\n//# sourceMappingURL=filters.js.map","var QueryIterator = /** @class */ (function () {\n    function QueryIterator(query, game) {\n        this.query = query;\n        this.game = game;\n        this.archetypeIndex = 0;\n        this.archetypeIterator = null;\n        this.result = {\n            done: true,\n            value: null,\n        };\n        this.changedFilters = query.filter.filter(function (f) { return f.kind === 'changed'; });\n    }\n    QueryIterator.prototype.checkChangeFilter = function () {\n        var _this = this;\n        if (this.changedFilters.length === 0)\n            return true;\n        return this.changedFilters.some(function (filter) {\n            _this.game.componentManager.wasChangedLastFrame(_this.result.value.get(filter.Component.prototype.constructor).id);\n        });\n    };\n    QueryIterator.prototype.next = function () {\n        while (this.archetypeIndex < this.query.archetypes.length) {\n            if (!this.archetypeIterator) {\n                this.archetypeIterator = this.query.archetypes[this.archetypeIndex][Symbol.iterator]();\n            }\n            this.result = this.archetypeIterator.next();\n            // if changed() filter(s) are present, ensure a change has\n            // occurred in the specified components\n            if (!this.checkChangeFilter()) {\n                continue;\n            }\n            // result is assigned from the current archetype iterator result -\n            // if the archetype is done, we move on to the next archetype until\n            // we run out\n            if (this.result.done) {\n                this.archetypeIndex++;\n                this.archetypeIterator = null;\n                continue;\n            }\n            return this.result;\n        }\n        this.result.done = true;\n        this.archetypeIndex = 0;\n        return this.result;\n    };\n    return QueryIterator;\n}());\nexport { QueryIterator };\n//# sourceMappingURL=QueryIterator.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nimport { EventEmitter } from 'events';\nimport { isFilter, has } from './filters';\nimport { QueryIterator } from './QueryIterator';\nimport { logger } from './logger';\nvar Query = /** @class */ (function (_super) {\n    __extends(Query, _super);\n    function Query(game) {\n        var _a;\n        var _this = _super.call(this) || this;\n        _this.game = game;\n        _this.filter = [];\n        _this.archetypes = new Array();\n        _this.trackedEntities = [];\n        _this.addedThisFrame = [];\n        _this.removedThisFrame = [];\n        _this.changesThisFrame = 0;\n        _this.processDef = function (userDef) {\n            return userDef.map(function (fil) { return (isFilter(fil) ? fil : has(fil)); });\n        };\n        _this.matchArchetype = function (archetype) {\n            var e_1, _a;\n            var match = true;\n            try {\n                for (var _b = __values(_this.filter), _c = _b.next(); !_c.done; _c = _b.next()) {\n                    var filter = _c.value;\n                    switch (filter.kind) {\n                        case 'has':\n                            match = archetype.includes(filter.Component);\n                            break;\n                        case 'not':\n                            match = archetype.omits(filter.Component);\n                            break;\n                        case 'changed':\n                            match = archetype.includes(filter.Component);\n                            break;\n                        case 'any':\n                            match = filter.Components.some(function (Comp) { return archetype.includes(Comp); });\n                    }\n                    if (!match)\n                        return;\n                }\n            }\n            catch (e_1_1) { e_1 = { error: e_1_1 }; }\n            finally {\n                try {\n                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n                }\n                finally { if (e_1) throw e_1.error; }\n            }\n            _this.archetypes.push(archetype);\n            logger.debug(\"Query \" + _this.toString() + \" added Archetype \" + archetype.id);\n            archetype.on('entityRemoved', _this.handleEntityRemoved);\n            archetype.on('entityAdded', _this.handleEntityAdded);\n        };\n        _this.reset = function () {\n            _this.archetypes.length = 0;\n            _this.filter = [];\n            _this.game.archetypeManager.off('archetypeCreated', _this.matchArchetype);\n        };\n        // closure provides iterator properties\n        _this.iterator = new QueryIterator(_this, _this.game);\n        _this.handleEntityAdded = function (entity) {\n            _this.addToList(entity.id);\n        };\n        _this.handleEntityRemoved = function (entityId) {\n            _this.removeFromList(entityId);\n        };\n        _this.addToList = function (entityId) {\n            _this.trackedEntities.push(entityId);\n            var removedIndex = _this.removedThisFrame.indexOf(entityId);\n            if (removedIndex !== -1) {\n                // this was a transfer (removes happen first)\n                _this.removedThisFrame.splice(removedIndex, 1);\n                _this.changesThisFrame--;\n            }\n            else {\n                // only non-transfers count as adds\n                _this.addedThisFrame.push(entityId);\n                _this.changesThisFrame++;\n            }\n        };\n        _this.removeFromList = function (entityId) {\n            var index = _this.trackedEntities.indexOf(entityId);\n            if (index === -1)\n                return;\n            _this.trackedEntities.splice(index, 1);\n            _this.removedThisFrame.push(entityId);\n            _this.changesThisFrame++;\n        };\n        _this.resetStepTracking = function () {\n            _this.addedThisFrame.length = 0;\n            _this.removedThisFrame.length = 0;\n            _this.changesThisFrame = 0;\n        };\n        _this.processAddRemove = function () {\n            if (_this.changesThisFrame) {\n                _this.addedThisFrame.forEach(_this.emitAdded);\n                _this.removedThisFrame.forEach(_this.emitRemoved);\n            }\n        };\n        _this.emitAdded = function (entityId) {\n            logger.debug(\"Entity \" + entityId + \" added to query \" + _this.toString());\n            _this.emit('entityAdded', entityId);\n        };\n        _this.emitRemoved = function (entityId) {\n            logger.debug(\"Entity \" + entityId + \" removed from query \" + _this.toString());\n            _this.emit('entityRemoved', entityId);\n        };\n        _this.addedIterable = (_a = {},\n            _a[Symbol.iterator] = function () { return new AddedIterator(game, _this); },\n            _a);\n        // when do we reset the frame-specific tracking?\n        // right before we populate new values from this frame's operations.\n        game.on('preApplyOperations', _this.resetStepTracking);\n        // after we apply operations and register all changes for the frame,\n        // we do processing of final add/remove list\n        game.on('stepComplete', _this.processAddRemove);\n        return _this;\n    }\n    Query.prototype.initialize = function (def) {\n        var e_2, _a;\n        logger.debug(\"Initializing Query \" + this.toString());\n        this.filter = this.processDef(def);\n        Object.values(this.game.archetypeManager.archetypes).forEach(this.matchArchetype);\n        this.game.archetypeManager.on('archetypeCreated', this.matchArchetype);\n        // reset all tracking arrays\n        this.trackedEntities.length = 0;\n        this.addedThisFrame.length = 0;\n        this.removedThisFrame.length = 0;\n        this.changesThisFrame = 0;\n        try {\n            // bootstrap entities list -\n            // TODO: optimize?\n            for (var _b = __values(this), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var ent = _c.value;\n                this.trackedEntities.push(ent.id);\n                this.addedThisFrame.push(ent.id);\n                this.emitAdded(ent.id);\n            }\n        }\n        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_2) throw e_2.error; }\n        }\n    };\n    Query.prototype[Symbol.iterator] = function () {\n        return this.iterator;\n    };\n    Query.prototype.toString = function () {\n        return this.filter\n            .map(function (filterItem) {\n            if (isFilter(filterItem)) {\n                return filterItem.toString();\n            }\n            return filterItem.name;\n        })\n            .join(',');\n    };\n    Object.defineProperty(Query.prototype, \"archetypeIds\", {\n        get: function () {\n            return this.archetypes.map(function (a) { return a.id; });\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Query.prototype, \"entities\", {\n        get: function () {\n            return this.trackedEntities;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Query.prototype, \"addedIds\", {\n        get: function () {\n            return this.addedThisFrame;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Query.prototype, \"added\", {\n        get: function () {\n            return this.addedIterable;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Query.prototype, \"removedIds\", {\n        get: function () {\n            return this.removedThisFrame;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return Query;\n}(EventEmitter));\nexport { Query };\nvar AddedIterator = /** @class */ (function () {\n    function AddedIterator(game, query) {\n        this.game = game;\n        this.query = query;\n        this.index = 0;\n        this.result = {\n            done: true,\n            value: null,\n        };\n    }\n    AddedIterator.prototype.next = function () {\n        if (this.index >= this.query.addedIds.length) {\n            this.result.done = true;\n            return this.result;\n        }\n        this.result.done = false;\n        this.result.value = this.game.get(this.query.addedIds[this.index]);\n        return this.result;\n    };\n    return AddedIterator;\n}());\n//# sourceMappingURL=Query.js.map","import { ObjectPool } from './internal/objectPool';\nimport { Query } from './Query';\n// TODO: reuse queries with identical definitions!\nvar QueryManager = /** @class */ (function () {\n    function QueryManager(game) {\n        var _this = this;\n        this.game = game;\n        this.pool = new ObjectPool(function () { return new Query(_this.game); });\n    }\n    QueryManager.prototype.create = function (userDef) {\n        var query = this.pool.acquire();\n        query.initialize(userDef);\n        return query;\n    };\n    QueryManager.prototype.release = function (query) {\n        this.pool.release(query);\n    };\n    return QueryManager;\n}());\nexport { QueryManager };\n//# sourceMappingURL=QueryManager.js.map","import { ObjectPool } from './internal/objectPool';\nvar ComponentPool = /** @class */ (function () {\n    function ComponentPool(Type, game) {\n        var _this = this;\n        this.Type = Type;\n        this.game = game;\n        this.pool = new ObjectPool(function () { return new _this.Type(); });\n    }\n    ComponentPool.prototype.acquire = function (initial, id) {\n        if (initial === void 0) { initial = {}; }\n        var instance = this.pool.acquire();\n        this.Type.initialize(instance, initial, id);\n        return instance;\n    };\n    ComponentPool.prototype.release = function (instance) {\n        this.pool.release(instance);\n    };\n    Object.defineProperty(ComponentPool.prototype, \"ComponentType\", {\n        get: function () {\n            return this.Type;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ComponentPool;\n}());\nexport { ComponentPool };\n//# sourceMappingURL=ComponentPool.js.map","export var COMPONENT_CHANGE_HANDLE = Symbol('Component change handle');\nfunction defaultSerialize(instance) {\n    var gettersAndSetters = {};\n    var data = {};\n    var descriptors = Object.getOwnPropertyDescriptors(instance);\n    Object.keys(descriptors).forEach(function (key) {\n        var descriptor = descriptors[key];\n        if (typeof (descriptor === null || descriptor === void 0 ? void 0 : descriptor.get) === 'function' ||\n            typeof (descriptor === null || descriptor === void 0 ? void 0 : descriptor.set) === 'function') {\n            gettersAndSetters[key] = descriptor;\n        }\n        else if (descriptor.enumerable &&\n            descriptor.value &&\n            !(typeof descriptor.value === 'function')) {\n            data[key] = descriptor.value;\n        }\n    });\n    return JSON.stringify(data);\n}\nfunction defaultDeserialize(serialized, additionalProperties) {\n    var data = JSON.parse(serialized);\n    Object.defineProperties(data, additionalProperties);\n    return data;\n}\nfunction defaultInitialize(target, overrides, id) {\n    Object.assign(target, overrides);\n    target.id = id;\n}\nfunction BaseComponent(_a) {\n    var _b;\n    var defaults = _a.defaults;\n    return _b = /** @class */ (function () {\n            function BaseComponent() {\n                var _this = this;\n                this.id = 0;\n                this.__type = Object.getPrototypeOf(this).constructor.id;\n                this.reset = function () {\n                    Object.getPrototypeOf(_this).constructor.initialize(_this, defaults(), 0);\n                };\n                /**\n                 * Use this function to semantically apply mutations to a\n                 * Component instance and seamlessly set the updated=true flag.\n                 * Works well for instant changes to a Component inline with\n                 * the .get call to access it (see code example)\n                 *\n                 * @example\n                 * entity.get(MyComponent).update(myComponent => {\n                 *   // reference values on the instance to set new ones\n                 *   myComponent.value = myComponent.value + 1;\n                 *   // upon function completion, myComponent.updated is\n                 *   // set `true` for you\n                 * });\n                 */\n                this.update = function (updater) {\n                    updater(_this);\n                    _this.updated = true;\n                };\n                Object.assign(this, defaults());\n            }\n            Object.defineProperty(BaseComponent.prototype, \"updated\", {\n                /**\n                 * This flag must be set whenever you make changes to a\n                 * Component instance which you want to be reported to\n                 * changed() filters in queries.\n                 */\n                set: function (_) {\n                    var _a;\n                    (_a = this[COMPONENT_CHANGE_HANDLE]) === null || _a === void 0 ? void 0 : _a.call(this, this);\n                },\n                enumerable: false,\n                configurable: true\n            });\n            return BaseComponent;\n        }()),\n        _b.id = 0,\n        _b.defaults = defaults,\n        _b.initialize = defaultInitialize,\n        _b;\n}\nexport function Component(defaults, _a) {\n    var _b = _a === void 0 ? {} : _a, _c = _b.serialize, serialize = _c === void 0 ? defaultSerialize : _c, _d = _b.deserialize, deserialize = _d === void 0 ? defaultDeserialize : _d;\n    var Type = BaseComponent({ defaults: defaults });\n    Type.serialize = serialize;\n    Type.deserialize = deserialize;\n    Type.serialized = true;\n    return Type;\n}\nexport function State(defaults) {\n    var Type = BaseComponent({ defaults: defaults });\n    Type.serialized = false;\n    return Type;\n}\n//# sourceMappingURL=Component.js.map","import { ComponentPool } from './ComponentPool';\nimport { COMPONENT_CHANGE_HANDLE, } from './Component';\n/**\n * Manages pools of Components based on their Type, and\n * the presence of Components assigned to Entities.\n */\nvar ComponentManager = /** @class */ (function () {\n    function ComponentManager(componentTypes, game) {\n        var _this = this;\n        this.componentTypes = componentTypes;\n        this.game = game;\n        this.pools = new Array();\n        this.changed = new Array();\n        this.acquire = function (typeId, initialValues) {\n            var component = _this.pools[typeId].acquire(initialValues, _this.game.idManager.get());\n            component[COMPONENT_CHANGE_HANDLE] = _this.onComponentChanged;\n            return component;\n        };\n        this.release = function (instance) {\n            delete instance[COMPONENT_CHANGE_HANDLE];\n            return _this.pools[instance.__type].release(instance);\n        };\n        this.wasChangedLastFrame = function (componentInstanceId) {\n            return !!_this.changed[componentInstanceId];\n        };\n        this.onComponentChanged = function (component) {\n            _this.game.enqueueOperation({\n                op: 'markChanged',\n                componentId: component.id,\n            });\n        };\n        this.markChanged = function (component) {\n            _this.changed[component.id] = true;\n        };\n        this.resetChanged = function () {\n            _this.changed.length = 0;\n        };\n        this.getTypeName = function (typeId) {\n            return _this.pools[typeId].ComponentType.name;\n        };\n        // initialize pools, one for each ComponentType by ID. ComponentType IDs are incrementing integers.\n        Object.values(componentTypes).forEach(function (Type) {\n            // assign an ID\n            Type.id = game.idManager.get();\n            // create a pool\n            _this.pools[Type.id] = new ComponentPool(Type, _this.game);\n        });\n        // TODO: right time to do this?\n        game.on('preApplyOperations', this.resetChanged);\n    }\n    return ComponentManager;\n}());\nexport { ComponentManager };\n//# sourceMappingURL=ComponentManager.js.map","/**\n * IDs = 32-bit integers.\n * Lowest 24 bits are the ID itself.\n * Highest 8 bits are the version.\n * An ID with an incremented version is the same ID (same index),\n * but indicates that the resource referred to by an older version\n * is no longer existent.\n */\nexport var VERSION_MASK = 4278190080;\nexport var SIGNIFIER_MASK = 16777215;\n/**\n * Gets only the portion of the ID that signifes the\n * resource it represents.\n */\nexport function getIdSignifier(id) {\n    // mask out high 8 bits\n    return SIGNIFIER_MASK & id;\n}\n/**\n * Gets only the version portion of the ID\n */\nexport function getIdVersion(id) {\n    return id >>> 24;\n}\nexport function setIdVersion(id, version) {\n    version = version % 255 << 24;\n    return id | version;\n}\nexport function incrementIdVersion(id) {\n    return setIdVersion(id, getIdVersion(id) + 1);\n}\n//# sourceMappingURL=ids.js.map","import { incrementIdVersion, SIGNIFIER_MASK } from './ids';\n/**\n * Provides monotonically increasing ID numbers. Allows\n * releasing unused IDs back to pool.\n */\nvar IdManager = /** @class */ (function () {\n    function IdManager() {\n        this.recycled = new Array();\n        this.active = new Array();\n        this.allocatedCount = 0;\n    }\n    IdManager.prototype.get = function () {\n        var id;\n        id = this.recycled.shift();\n        if (!id) {\n            if (this.allocatedCount >= SIGNIFIER_MASK) {\n                throw new Error('Ran out of IDs');\n            }\n            // FIXME: incrementing first means ids start at 1\n            id = ++this.allocatedCount;\n        }\n        return id;\n    };\n    IdManager.prototype.release = function (id) {\n        var index = this.active.indexOf(id);\n        if (index === -1) {\n            throw new Error(\"Tried to release inactive ID \" + id);\n        }\n        this.active.splice(index);\n        this.recycled.push(incrementIdVersion(id));\n    };\n    return IdManager;\n}());\nexport { IdManager };\n//# sourceMappingURL=IdManager.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nimport { EventEmitter } from 'events';\n/**\n * Archetype is a group of Entities which share a common component signature.\n * Archetypes are the storage system for Entities; each Entity traces back to an Archetype's\n * entities array. When Entity components change, they are moved from Archetype to Archetype.\n * Grouping in this way is a helpful shortcut to fulfilling Query filter requirements,\n * as we only need to map a small number of Archetypes -> Query, versus iterating over\n * and checking every Entity in the system at init and then on every change.\n */\nvar Archetype = /** @class */ (function (_super) {\n    __extends(Archetype, _super);\n    function Archetype(id) {\n        var _this = _super.call(this) || this;\n        _this.id = id;\n        _this.entities = new Array();\n        /** Maps entity ID -> index in entity array */\n        _this.entityIndexLookup = new Array();\n        _this.hasAll = function (types) {\n            var masked = types\n                .reduce(function (m, T) {\n                m[T.id] = '1';\n                return m;\n            }, _this.id.split(''))\n                .join('');\n            return _this.id === masked;\n        };\n        _this.hasSome = function (types) {\n            var e_1, _a;\n            try {\n                for (var types_1 = __values(types), types_1_1 = types_1.next(); !types_1_1.done; types_1_1 = types_1.next()) {\n                    var T = types_1_1.value;\n                    if (_this.id[T.id] === '1')\n                        return true;\n                }\n            }\n            catch (e_1_1) { e_1 = { error: e_1_1 }; }\n            finally {\n                try {\n                    if (types_1_1 && !types_1_1.done && (_a = types_1.return)) _a.call(types_1);\n                }\n                finally { if (e_1) throw e_1.error; }\n            }\n            return false;\n        };\n        _this.includes = function (Type) {\n            return _this.id[Type.id] === '1';\n        };\n        _this.omits = function (Type) {\n            return !_this.includes(Type);\n        };\n        _this.setMaxListeners(10000000);\n        return _this;\n    }\n    /**\n     * Archetype is iterable; iterating it will iterate over its stored\n     * Entities.\n     */\n    Archetype.prototype[Symbol.iterator] = function () {\n        return this.entities[Symbol.iterator]();\n    };\n    Archetype.prototype.addEntity = function (entity) {\n        // this is the index (\"column\") of this entity in the table\n        var index = this.entities.length;\n        // for lookup later when presented with an entityId\n        this.entityIndexLookup[entity.id] = index;\n        // add entity data to the column of all data arrays\n        this.entities[index] = entity;\n        this.emit('entityAdded', entity);\n    };\n    /**\n     * Removes an entity from the archetype table, returning its\n     * component data list\n     */\n    Archetype.prototype.removeEntity = function (entityId) {\n        var index = this.entityIndexLookup[entityId];\n        if (index === undefined) {\n            throw new Error(\"Tried to remove \" + entityId + \" from archetype \" + this.id + \", but was not present\");\n        }\n        this.entityIndexLookup[entityId] = undefined;\n        var _a = __read(this.entities.splice(index, 1), 1), entity = _a[0];\n        // FIXME: improve this!!! Maybe look into a linked list like that one blog post...\n        // decrement all entity index lookups that fall after this index\n        for (var i = 0; i < this.entityIndexLookup.length; i++) {\n            if (this.entityIndexLookup[i] && this.entityIndexLookup[i] > index) {\n                this.entityIndexLookup[i]--;\n            }\n        }\n        this.emit('entityRemoved', entityId);\n        return entity;\n    };\n    Archetype.prototype.getEntity = function (entityId) {\n        var index = this.entityIndexLookup[entityId];\n        if (index === undefined) {\n            throw new Error(\"Could not find entity \" + entityId + \" in archetype \" + this.id);\n        }\n        return this.entities[index];\n    };\n    Archetype.prototype.toString = function () {\n        return this.id;\n    };\n    return Archetype;\n}(EventEmitter));\nexport { Archetype };\n//# sourceMappingURL=Archetype.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { EventEmitter } from 'events';\nimport { Archetype } from './Archetype';\nimport { logger } from './logger';\nvar ArchetypeManager = /** @class */ (function (_super) {\n    __extends(ArchetypeManager, _super);\n    function ArchetypeManager(game) {\n        var _this = _super.call(this) || this;\n        _this.game = game;\n        // maps entity ids to archetypes\n        _this.entityLookup = new Array();\n        // maps archetype id bitstrings to Archetype instances\n        _this.archetypes = {};\n        // FIXME: why +1 here? Component ids are not starting at 0... this\n        // should be more elegant\n        _this.emptyId = new Array(_this.game.componentManager.componentTypes.length + 1)\n            .fill('0')\n            .join('');\n        _this.archetypes[_this.emptyId] = new Archetype(_this.emptyId);\n        _this.setMaxListeners(1000000);\n        return _this;\n    }\n    ArchetypeManager.prototype.createEntity = function (entityId) {\n        logger.debug(\"Creating entity \" + entityId);\n        this.entityLookup[entityId] = this.emptyId;\n        // allocate an Entity\n        var entity = this.game.entityPool.acquire();\n        entity.__set(entityId, []);\n        this.getOrCreate(this.emptyId).addEntity(entity);\n        this.emit('entityCreated', entityId);\n    };\n    ArchetypeManager.prototype.addComponent = function (entityId, instance) {\n        logger.debug(\"Adding \" + Object.getPrototypeOf(instance).constructor.name + \" to entity \" + entityId);\n        var oldArchetypeId = this.entityLookup[entityId];\n        if (oldArchetypeId === undefined) {\n            throw new Error(\"Tried to add component \" + instance.__type + \" to \" + entityId + \", but it was not found in the archetype registry\");\n        }\n        var oldArchetype = this.getOrCreate(oldArchetypeId);\n        // remove data from old archetype\n        var entity = oldArchetype.removeEntity(entityId);\n        entity.__addComponent(instance);\n        var newArchetypeId = (this.entityLookup[entityId] = this.flipBit(oldArchetypeId, instance.__type));\n        var archetype = this.getOrCreate(newArchetypeId);\n        // copy entity from old to new\n        archetype.addEntity(entity);\n        logger.debug(\"Entity \" + entityId + \" moved to archetype \" + newArchetypeId);\n        this.emit('entityComponentAdded', entityId, instance);\n    };\n    ArchetypeManager.prototype.removeComponent = function (entityId, componentType) {\n        logger.debug(\"Removing \" + this.game.componentManager.getTypeName(componentType) + \" from entity \" + entityId);\n        var oldArchetypeId = this.entityLookup[entityId];\n        if (oldArchetypeId === undefined) {\n            logger.warn(\"Tried to remove component \" + this.game.componentManager.getTypeName(componentType) + \" from \" + entityId + \", but it was not found in the archetype registry\");\n            return;\n        }\n        var oldArchetype = this.getOrCreate(oldArchetypeId);\n        var entity = oldArchetype.removeEntity(entityId);\n        var removed = entity.__removeComponent(componentType);\n        var newArchetypeId = (this.entityLookup[entityId] = this.flipBit(oldArchetypeId, componentType));\n        var archetype = this.getOrCreate(newArchetypeId);\n        archetype.addEntity(entity);\n        logger.debug(\"Entity \" + entityId + \" moved to archetype \" + newArchetypeId);\n        this.emit('entityComponentRemoved', entityId, componentType);\n        return removed;\n    };\n    ArchetypeManager.prototype.destroyEntity = function (entityId) {\n        logger.debug(\"Destroying entity \" + entityId);\n        var archetypeId = this.entityLookup[entityId];\n        if (archetypeId === undefined) {\n            throw new Error(\"Tried to destroy \" + entityId + \", but it was not found in archetype registry\");\n        }\n        this.entityLookup[entityId] = undefined;\n        var archetype = this.archetypes[archetypeId];\n        var entity = archetype.removeEntity(entityId);\n        this.emit('entityDestroyed', entityId);\n        return entity;\n    };\n    ArchetypeManager.prototype.getEntity = function (entityId) {\n        var archetypeId = this.entityLookup[entityId];\n        if (archetypeId === undefined) {\n            logger.debug(\"Could not find Archetype for Entity \" + entityId);\n            return null;\n        }\n        var archetype = this.archetypes[archetypeId];\n        return archetype.getEntity(entityId);\n    };\n    ArchetypeManager.prototype.getOrCreate = function (id) {\n        var archetype = this.archetypes[id];\n        if (!archetype) {\n            archetype = this.archetypes[id] = new Archetype(id);\n            logger.debug(\"New Archetype \" + id + \" created\");\n            this.emit('archetypeCreated', archetype);\n        }\n        return archetype;\n    };\n    ArchetypeManager.prototype.flipBit = function (id, typeId) {\n        return (id.substr(0, typeId) +\n            (id[typeId] === '1' ? '0' : '1') +\n            id.substr(typeId + 1));\n    };\n    return ArchetypeManager;\n}(EventEmitter));\nexport { ArchetypeManager };\n//# sourceMappingURL=ArchetypeManager.js.map","var Entity = /** @class */ (function () {\n    function Entity() {\n        var _this = this;\n        this._id = 0;\n        // TODO: make array\n        this.components = new Map();\n        this._destroyed = true;\n        // TODO: hide these behind Symbols?\n        this.__set = function (entityId, components) {\n            _this._id = entityId;\n            _this.components.clear();\n            components.forEach(function (comp) {\n                _this.components.set(comp.__type, comp);\n            });\n            _this._destroyed = false;\n        };\n        this.__addComponent = function (instance) {\n            _this.components.set(instance.__type, instance);\n        };\n        this.__removeComponent = function (typeId) {\n            var instance = _this.components.get(typeId);\n            _this.components.delete(typeId);\n            return instance;\n        };\n        this.get = function (Type) {\n            var _a;\n            var instance = ((_a = _this.components.get(Type.id)) !== null && _a !== void 0 ? _a : null);\n            console.assert(!instance || instance.id !== 0, \"Entity tried to access recycled Component instance of type \" + Type.name);\n            return instance;\n        };\n        this.maybeGet = function (Type) {\n            var _a;\n            return ((_a = _this.components.get(Type.id)) !== null && _a !== void 0 ? _a : null);\n        };\n    }\n    Object.defineProperty(Entity.prototype, \"id\", {\n        get: function () {\n            return this._id;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Entity.prototype, \"destroyed\", {\n        get: function () {\n            return this._destroyed;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Entity.prototype.reset = function () {\n        this.components.clear();\n        // disabled to diagnose issues...\n        this._id = 0;\n        this._destroyed = true;\n    };\n    Entity.prototype.clone = function (other) {\n        var _this = this;\n        other.components.forEach(function (value, key) {\n            _this.components.set(key, value);\n        });\n        this._id = other.id;\n    };\n    return Entity;\n}());\nexport { Entity };\n//# sourceMappingURL=Entity.js.map","var ResourceHandle = /** @class */ (function () {\n    function ResourceHandle() {\n        var _this = this;\n        this._resolve = function () {\n            throw new Error('Cannot resolve this resource yet');\n        };\n        this._value = null;\n        this.__alive = false;\n        this.resolve = function (value) {\n            _this._resolve(value);\n            _this._value = value;\n        };\n        this.reset = function () {\n            _this._resolve = function () {\n                throw new Error('Cannot resolve this resource yet');\n            };\n            _this._promise = new Promise(function (resolve) {\n                _this._resolve = resolve;\n            });\n            _this._value = null;\n        };\n        this._promise = new Promise(function (resolve) {\n            _this._resolve = resolve;\n        });\n    }\n    Object.defineProperty(ResourceHandle.prototype, \"value\", {\n        get: function () {\n            return this._value;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(ResourceHandle.prototype, \"promise\", {\n        get: function () {\n            return this._promise;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return ResourceHandle;\n}());\nexport { ResourceHandle };\n//# sourceMappingURL=ResourceHandle.js.map","import { ObjectPool } from './internal/objectPool';\nimport { logger } from './logger';\nimport { ResourceHandle } from './ResourceHandle';\nvar Resources = /** @class */ (function () {\n    function Resources() {\n        var _this = this;\n        this.handlePool = new ObjectPool(function () { return new ResourceHandle(); });\n        this.handles = new Map();\n        this.getOrCreateGlobalHandle = function (key) {\n            var handle = _this.handles.get(key);\n            if (!handle) {\n                handle = _this.handlePool.acquire();\n                _this.handles.set(key, handle);\n            }\n            return handle;\n        };\n        this.load = function (key) {\n            return _this.getOrCreateGlobalHandle(key).promise;\n        };\n        this.resolve = function (key, value) {\n            _this.getOrCreateGlobalHandle(key).resolve(value);\n            logger.debug('Resolved resource', key);\n        };\n        this.immediate = function (key) {\n            return _this.getOrCreateGlobalHandle(key).value;\n        };\n        this.remove = function (key) {\n            var value = _this.handles.get(key);\n            if (value) {\n                _this.handlePool.release(value);\n                _this.handles.delete(key);\n            }\n        };\n    }\n    return Resources;\n}());\nexport { Resources };\n//# sourceMappingURL=Resources.js.map","/**\n * Manages \"removed\" Entities, stuck in limbo between being\n * 'deleted' (from user perspective) and formally returned to\n * pools.\n */\nvar RemovedList = /** @class */ (function () {\n    function RemovedList() {\n        var _this = this;\n        this._list = new Array();\n        this._lookup = new Array();\n        this.add = function (entity) {\n            _this._lookup[entity.id] = _this._list.length;\n            _this._list.push(entity);\n        };\n        this.flush = function (callback) {\n            while (_this._list.length) {\n                callback(_this._list.shift());\n            }\n            _this._lookup.length = 0;\n        };\n        this.get = function (entityId) {\n            var _a;\n            return (_a = _this._list[_this._lookup[entityId]]) !== null && _a !== void 0 ? _a : null;\n        };\n    }\n    return RemovedList;\n}());\nexport { RemovedList };\n//# sourceMappingURL=RemovedList.js.map","import { ObjectPool } from './internal/objectPool';\nimport { ResourceHandle } from './ResourceHandle';\nvar Assets = /** @class */ (function () {\n    function Assets(_loaders) {\n        var _this = this;\n        this._loaders = _loaders;\n        this.handlePool = new ObjectPool(function () { return new ResourceHandle(); });\n        this.handles = new Map();\n        this.load = function (loader, key) {\n            var handle = _this.handles.get(_this.getKey(loader, key));\n            if (!handle) {\n                handle = _this.handlePool.acquire();\n                _this.handles.set(_this.getKey(loader, key), handle);\n                _this._loaders[loader](key).then(function (value) { return handle.resolve(value); });\n            }\n            return handle.promise;\n        };\n        this.immediate = function (loader, key) {\n            var handle = _this.handles.get(_this.getKey(loader, key));\n            if (!handle)\n                return null;\n            return handle.value;\n        };\n        this.getKey = function (loader, key) { return loader + \":\" + key; };\n    }\n    return Assets;\n}());\nexport { Assets };\n//# sourceMappingURL=Assets.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nimport { EventEmitter } from 'events';\nimport { QueryManager } from './QueryManager';\nimport { ComponentManager } from './ComponentManager';\nimport { IdManager } from './IdManager';\nimport { ArchetypeManager } from './ArchetypeManager';\nimport { Entity } from './Entity';\nimport { Resources } from './Resources';\nimport { ObjectPool } from './internal/objectPool';\nimport { RemovedList } from './RemovedList';\nimport { Assets } from './Assets';\nvar Game = /** @class */ (function (_super) {\n    __extends(Game, _super);\n    function Game(_a) {\n        var components = _a.components, _b = _a.systems, systems = _b === void 0 ? [] : _b, _c = _a.assetLoaders, assetLoaders = _c === void 0 ? {} : _c;\n        var _this = _super.call(this) || this;\n        _this._idManager = new IdManager();\n        _this._operationQueue = [];\n        _this._globals = new Resources();\n        _this._entityPool = new ObjectPool(function () { return new Entity(); });\n        _this._removedList = new RemovedList();\n        // TODO: configurable?\n        _this._phases = ['preStep', 'step', 'postStep'];\n        _this._delta = 0;\n        _this._time = 0;\n        _this._constants = {\n            maxComponentId: 256,\n            maxEntities: Math.pow(2, 16),\n        };\n        /**\n         * Allocates a new entity id and enqueues an operation to create the entity at the next opportunity.\n         */\n        _this.create = function () {\n            var id = _this.idManager.get();\n            _this._operationQueue.push({\n                op: 'createEntity',\n                entityId: id,\n            });\n            return id;\n        };\n        /**\n         * Enqueues an entity to be destroyed at the next opportunity\n         */\n        _this.destroy = function (id) {\n            _this._operationQueue.push({\n                op: 'removeEntity',\n                entityId: id,\n            });\n        };\n        /**\n         * Add a component to an entity.\n         */\n        _this.add = function (entityId, Type, initial) {\n            _this._operationQueue.push({\n                op: 'addComponent',\n                entityId: entityId,\n                componentType: Type.id,\n                initialValues: initial,\n            });\n        };\n        /**\n         * Remove a component by type from an entity\n         */\n        _this.remove = function (entityId, Type) {\n            _this._operationQueue.push({\n                op: 'removeComponent',\n                entityId: entityId,\n                componentType: Type.id,\n            });\n        };\n        /**\n         * Get a single entity by its known ID\n         */\n        _this.get = function (entityId) {\n            var _a;\n            return ((_a = _this.archetypeManager.getEntity(entityId)) !== null && _a !== void 0 ? _a : _this._removedList.get(entityId));\n        };\n        /**\n         * Run some logic for each entity that meets an ad-hoc query.\n         */\n        _this.query = function (filter, run) {\n            var e_1, _a;\n            var query = _this._queryManager.create(filter);\n            var ent;\n            try {\n                for (var query_1 = __values(query), query_1_1 = query_1.next(); !query_1_1.done; query_1_1 = query_1.next()) {\n                    ent = query_1_1.value;\n                    run(ent, _this);\n                }\n            }\n            catch (e_1_1) { e_1 = { error: e_1_1 }; }\n            finally {\n                try {\n                    if (query_1_1 && !query_1_1.done && (_a = query_1.return)) _a.call(query_1);\n                }\n                finally { if (e_1) throw e_1.error; }\n            }\n        };\n        /**\n         * Manually step the game simulation forward. Provide a\n         * delta (in ms) of time elapsed since last frame.\n         */\n        _this.step = function (delta) {\n            _this._delta = delta;\n            _this._phases.forEach(function (phase) {\n                _this.emit(phase);\n            });\n            _this.emit('destroyEntities');\n            _this._removedList.flush(_this.destroyEntity);\n            _this.emit('preApplyOperations');\n            _this.flushOperations();\n            _this.emit('stepComplete');\n        };\n        _this.enqueueOperation = function (operation) {\n            _this._operationQueue.push(operation);\n        };\n        _this.destroyEntity = function (entity) {\n            entity.components.forEach(function (instance) {\n                if (instance)\n                    _this.componentManager.release(instance);\n            });\n            _this.entityPool.release(entity);\n        };\n        _this.flushOperations = function () {\n            while (_this._operationQueue.length) {\n                _this.applyOperation(_this._operationQueue.shift());\n            }\n        };\n        _this.applyOperation = function (operation) {\n            var instance;\n            var entity;\n            switch (operation.op) {\n                case 'addComponent':\n                    if (operation.entityId === 0)\n                        break;\n                    instance = _this.componentManager.acquire(operation.componentType, operation.initialValues);\n                    _this.archetypeManager.addComponent(operation.entityId, instance);\n                    break;\n                case 'removeComponent':\n                    if (operation.entityId === 0)\n                        break;\n                    instance = _this.archetypeManager.removeComponent(operation.entityId, operation.componentType);\n                    if (instance) {\n                        _this.componentManager.release(instance);\n                    }\n                    break;\n                case 'createEntity':\n                    _this.archetypeManager.createEntity(operation.entityId);\n                    break;\n                case 'removeEntity':\n                    if (operation.entityId === 0)\n                        break;\n                    entity = _this.archetypeManager.destroyEntity(operation.entityId);\n                    _this._removedList.add(entity);\n                    break;\n                case 'markChanged':\n                    _this.componentManager.markChanged(operation.componentId);\n                    break;\n            }\n        };\n        _this.setMaxListeners(Infinity);\n        _this._componentManager = new ComponentManager(components, _this);\n        _this._assets = new Assets(assetLoaders);\n        _this._queryManager = new QueryManager(_this);\n        _this._archetypeManager = new ArchetypeManager(_this);\n        _this._runnableCleanups = systems.map(function (sys) { return sys(_this); });\n        return _this;\n    }\n    Object.defineProperty(Game.prototype, \"idManager\", {\n        get: function () {\n            return this._idManager;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Game.prototype, \"componentManager\", {\n        get: function () {\n            return this._componentManager;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Game.prototype, \"archetypeManager\", {\n        get: function () {\n            return this._archetypeManager;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Game.prototype, \"delta\", {\n        get: function () {\n            return this._delta;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Game.prototype, \"time\", {\n        get: function () {\n            return this._time;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Game.prototype, \"queryManager\", {\n        get: function () {\n            return this._queryManager;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Game.prototype, \"constants\", {\n        get: function () {\n            return this._constants;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Game.prototype, \"globals\", {\n        get: function () {\n            return this._globals;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Game.prototype, \"assets\", {\n        get: function () {\n            return this._assets;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Game.prototype, \"entityPool\", {\n        get: function () {\n            return this._entityPool;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return Game;\n}(EventEmitter));\nexport { Game };\n//# sourceMappingURL=Game.js.map","var __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nexport function makeSystem(filter, run, phase) {\n    if (phase === void 0) { phase = 'step'; }\n    return function (game) {\n        var query = game.queryManager.create(filter);\n        function onPhase() {\n            var e_1, _a;\n            var ent;\n            try {\n                for (var query_1 = __values(query), query_1_1 = query_1.next(); !query_1_1.done; query_1_1 = query_1.next()) {\n                    ent = query_1_1.value;\n                    run(ent, game);\n                }\n            }\n            catch (e_1_1) { e_1 = { error: e_1_1 }; }\n            finally {\n                try {\n                    if (query_1_1 && !query_1_1.done && (_a = query_1.return)) _a.call(query_1);\n                }\n                finally { if (e_1) throw e_1.error; }\n            }\n        }\n        game.on(phase, onPhase);\n        return function () {\n            game.off(phase, onPhase);\n        };\n    };\n}\n//# sourceMappingURL=System.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nexport function makeEffect(filter, effect, cleanup) {\n    return function (game) {\n        var query = game.queryManager.create(filter);\n        var abortControllers = new Array();\n        function onEntityAdded(entityId) {\n            return __awaiter(this, void 0, void 0, function () {\n                var entity, abortController, result;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            entity = game.get(entityId);\n                            if (!entity) {\n                                throw new Error(\"Effect triggered for entity \" + entityId + \", but it was not found\");\n                            }\n                            abortController = new AbortController();\n                            abortControllers[entityId] = abortController;\n                            result = effect(entity, game, abortController.signal);\n                            if (!result) return [3 /*break*/, 2];\n                            return [4 /*yield*/, pullCancelable(result, abortController.signal)];\n                        case 1:\n                            _a.sent();\n                            _a.label = 2;\n                        case 2: return [2 /*return*/];\n                    }\n                });\n            });\n        }\n        function onEntityRemoved(entityId) {\n            var _a;\n            return __awaiter(this, void 0, void 0, function () {\n                var entity, result;\n                return __generator(this, function (_b) {\n                    switch (_b.label) {\n                        case 0:\n                            (_a = abortControllers[entityId]) === null || _a === void 0 ? void 0 : _a.abort();\n                            entity = game.get(entityId);\n                            if (!entity) {\n                                throw new Error(\"Effect cleanup triggered for entity \" + entityId + \", but it was not found\");\n                            }\n                            result = cleanup(entity, game);\n                            if (!result) return [3 /*break*/, 2];\n                            return [4 /*yield*/, pull(result)];\n                        case 1:\n                            _b.sent();\n                            _b.label = 2;\n                        case 2: return [2 /*return*/];\n                    }\n                });\n            });\n        }\n        query.on('entityAdded', onEntityAdded);\n        if (cleanup) {\n            query.on('entityRemoved', onEntityRemoved);\n        }\n        return function () {\n            query.off('entityAdded', onEntityAdded);\n            if (cleanup) {\n                query.off('entityRemoved', onEntityRemoved);\n            }\n        };\n    };\n}\nfunction pull(generator, input) {\n    return __awaiter(this, void 0, void 0, function () {\n        var _a, done, value, nextInput, _b;\n        return __generator(this, function (_c) {\n            switch (_c.label) {\n                case 0:\n                    _a = generator.next(input), done = _a.done, value = _a.value;\n                    if (!(value instanceof Promise)) return [3 /*break*/, 2];\n                    return [4 /*yield*/, value];\n                case 1:\n                    _b = _c.sent();\n                    return [3 /*break*/, 3];\n                case 2:\n                    _b = value;\n                    _c.label = 3;\n                case 3:\n                    nextInput = _b;\n                    if (!!done) return [3 /*break*/, 5];\n                    return [4 /*yield*/, pull(generator, nextInput)];\n                case 4:\n                    _c.sent();\n                    _c.label = 5;\n                case 5: return [2 /*return*/];\n            }\n        });\n    });\n}\nfunction pullCancelable(generator, abortSignal, input) {\n    return __awaiter(this, void 0, void 0, function () {\n        var _a, done, value, nextInput, _b;\n        return __generator(this, function (_c) {\n            switch (_c.label) {\n                case 0:\n                    if (abortSignal.aborted)\n                        return [2 /*return*/];\n                    _a = generator.next(input), done = _a.done, value = _a.value;\n                    if (!(value instanceof Promise)) return [3 /*break*/, 2];\n                    return [4 /*yield*/, value];\n                case 1:\n                    _b = _c.sent();\n                    return [3 /*break*/, 3];\n                case 2:\n                    _b = value;\n                    _c.label = 3;\n                case 3:\n                    nextInput = _b;\n                    if (!!done) return [3 /*break*/, 5];\n                    return [4 /*yield*/, pullCancelable(generator, abortSignal, nextInput)];\n                case 4:\n                    _c.sent();\n                    _c.label = 5;\n                case 5: return [2 /*return*/];\n            }\n        });\n    });\n}\n//# sourceMappingURL=Effect.js.map","export function compose() {\n    var systems = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        systems[_i] = arguments[_i];\n    }\n    return function (game) {\n        var cleanups = systems.map(function (sys) { return sys(game); });\n        return function () {\n            cleanups.forEach(function (cleanup) { return cleanup(); });\n        };\n    };\n}\n//# sourceMappingURL=compose.js.map","import { Component, State } from '0g';\n\nexport class Player extends Component(() => ({\n  rotateSpeed: 3,\n  thrustForce: 2,\n})) {}\n\nexport class Damageable extends Component(() => ({\n  maxHealth: 3,\n  health: 3,\n  invulnerableFrames: 5 * 60, // ~5s,\n  damageFrom: ['bullet'],\n})) {\n  // ephemeral state\n  private __invulnerableTimer = 0;\n  addDamage(force = false) {\n    if (!this.vulnerable && !force) return;\n    this.health = Math.max(0, this.health - 1);\n    this.__invulnerableTimer = this.invulnerableFrames;\n    this.updated = true;\n  }\n  get vulnerable() {\n    return this.__invulnerableTimer === 0;\n  }\n  get dead() {\n    return this.health === 0;\n  }\n  tickInvulnerability() {\n    this.__invulnerableTimer = Math.max(0, this.__invulnerableTimer - 1);\n  }\n}\n\nexport class ColliderTag extends Component(() => ({\n  group: 'bullet',\n})) {}\n\nexport class Asteroid extends Component(() => ({\n  size: 3,\n  variant: Math.floor(Math.random() * 3),\n})) {}\n\nexport class Bullet extends Component(() => ({\n  speed: 8,\n})) {}\n\nexport class SpriteConfig extends Component(() => ({\n  path: 'm 0 0 l 5 0 l 0 5 l -5 0 l 0 -5',\n  stroke: 'white',\n  dashGap: 0,\n})) {}\n\nexport class Sprite extends State(() => ({\n  element: (null as any) as SVGGElement,\n  path: (null as any) as SVGPathElement,\n})) {}\n","import { BodyShape } from './types';\nimport { Component, State } from '0g';\nimport { b2Body } from '@flyover/box2d';\nimport { EntityContact } from './ContactListener';\n\nexport class Transform extends Component(() => ({\n  x: 0,\n  y: 0,\n  angle: 0,\n})) {\n  get position() {\n    return {\n      x: this.x,\n      y: this.y,\n    };\n  }\n}\n\nexport class BodyConfig extends Component(() => ({\n  shape: {\n    shape: 'circle',\n    radius: 1,\n  } as BodyShape,\n  density: 1,\n  friction: 0,\n  // TODO: literal string to include kinematic\n  isStatic: false,\n  angle: 0,\n  restitution: 0,\n  bullet: false,\n  fixedRotation: false,\n  angularDamping: 0,\n  linearDamping: 0,\n  sensor: false,\n})) {}\n\nexport class Body extends State(() => ({\n  value: (null as any) as b2Body,\n})) {}\n\nexport class Contacts extends State(() => ({\n  began: new Array<EntityContact>(),\n  ended: new Array<EntityContact>(),\n  current: new Array<EntityContact>(),\n})) {}\n\nexport class ContactsCache extends State(() => ({\n  began: new Set<EntityContact>(),\n  ended: new Set<EntityContact>(),\n})) {\n  onBeginContact(contact: EntityContact) {\n    this.began.add(contact);\n    this.updated = true;\n  }\n  onEndContact(contact: EntityContact) {\n    this.ended.add(contact);\n    this.updated = true;\n  }\n}\n\nexport class WorldConfig extends Component(() => ({\n  gravity: { x: 0, y: 0 },\n})) {}\n","import { b2Contact, b2ContactListener, b2Fixture } from '@flyover/box2d';\n\nexport type EntityContact = {\n  selfId: number | null;\n  otherId: number | null;\n  contact: b2Contact;\n  otherFixture: b2Fixture;\n  selfFixture: b2Fixture;\n  id: string;\n};\n\n// const contactPairCache: Record<string, [EntityContact, EntityContact]> = {};\nconst contactPairCache = new WeakMap<\n  b2Contact,\n  [EntityContact, EntityContact]\n>();\n\nfunction getOrCreatePair(contact: b2Contact) {\n  const aData = contact.GetFixtureA().GetUserData() ?? {};\n  const bData = contact.GetFixtureB().GetUserData() ?? {};\n  const aId = (aData.entityId as number) || null;\n  const bId = (bData.entityId as number) || null;\n\n  let pair = contactPairCache.get(contact);\n  if (pair) {\n    return pair;\n  }\n  pair = [{} as any, {} as any];\n  pair[0].selfId = aId;\n  pair[0].otherId = bId;\n  pair[0].contact = contact;\n  pair[0].otherFixture = contact.GetFixtureB();\n  pair[0].selfFixture = contact.GetFixtureA();\n  pair[1].selfId = bId;\n  pair[1].otherId = aId;\n  pair[1].contact = contact;\n  pair[1].otherFixture = contact.GetFixtureA();\n  pair[1].selfFixture = contact.GetFixtureB();\n  pair[0].id = `${Math.random().toFixed(10)}`;\n  pair[1].id = `${Math.random().toFixed(10)}`;\n  contactPairCache.set(contact, pair);\n  return pair;\n}\n\nfunction cleanupPair(contact: b2Contact) {\n  const pair = contactPairCache.get(contact);\n  if (pair) {\n    contactPairCache.delete(contact);\n  }\n}\n\ntype EntityContactListeners = {\n  onBeginContact?(contact: EntityContact): void;\n  onEndContact?(contact: EntityContact): void;\n};\n\nexport class ContactListener implements b2ContactListener {\n  private entityListeners: EntityContactListeners[] = [];\n  /** @private */\n  BeginContact(contact: b2Contact) {\n    this.invokeListeners(contact, 'onBeginContact');\n  }\n  /** @private */\n  EndContact(contact: b2Contact) {\n    this.invokeListeners(contact, 'onEndContact');\n  }\n\n  BeginContactFixtureParticle() {\n    return;\n  }\n  EndContactFixtureParticle() {\n    return;\n  }\n  BeginContactParticleParticle() {\n    return;\n  }\n  EndContactParticleParticle() {\n    return;\n  }\n  PreSolve() {\n    return;\n  }\n  PostSolve() {\n    return;\n  }\n\n  subscribe = (entityId: number, listeners: EntityContactListeners) => {\n    this.entityListeners[entityId] = listeners;\n  };\n\n  unsubscribe = (entityId: number) => {\n    delete this.entityListeners[entityId];\n  };\n\n  private invokeListeners = (\n    contact: b2Contact,\n    event: 'onBeginContact' | 'onEndContact'\n  ) => {\n    const pair = getOrCreatePair(contact);\n\n    if (pair[0].selfId) {\n      this.entityListeners[pair[0].selfId]?.[event]?.(pair[0]);\n    }\n    if (pair[1].selfId) {\n      this.entityListeners[pair[1].selfId]?.[event]?.(pair[1]);\n    }\n\n    if (event === 'onEndContact') {\n      cleanupPair(contact);\n    }\n  };\n}\n","import { makeSystem, makeEffect, changed, Game, compose } from '0g';\nimport {\n  b2Body,\n  b2BodyType,\n  b2CircleShape,\n  b2EdgeShape,\n  b2FixtureDef,\n  b2PolygonShape,\n  b2World,\n} from '@flyover/box2d';\nimport { ContactListener, EntityContact } from './ContactListener';\nimport * as components from './components';\nimport { createCapsule } from './utils';\n\ndeclare module '0g' {\n  interface GameResources {\n    physicsWorld: b2World;\n    physicsContacts: ContactListener;\n  }\n}\n\nfunction assignBodyConfig(\n  body: b2Body,\n  config: components.BodyConfig,\n  id: number\n) {\n  const {\n    // TODO: verify assumptions about defaults\n    isStatic = false,\n    fixedRotation = false,\n    linearDamping = 0,\n    angularDamping = 0,\n  } = config;\n\n  body.SetType(isStatic ? b2BodyType.b2_staticBody : b2BodyType.b2_dynamicBody);\n  body.SetLinearDamping(linearDamping);\n  body.SetFixedRotation(fixedRotation);\n  body.SetAngularDamping(angularDamping);\n  body.SetUserData({\n    entityId: id,\n  });\n\n  return body;\n}\n\nfunction createFixtureDef(config: components.BodyConfig, id: number) {\n  const { density, restitution, friction, shape, sensor } = config;\n\n  const fix = new b2FixtureDef();\n  fix.density = density;\n  fix.restitution = restitution;\n  fix.friction = friction;\n  fix.userData = { entityId: id };\n  fix.isSensor = sensor;\n\n  let p: b2PolygonShape;\n  switch (shape.shape) {\n    case 'rectangle':\n      p = new b2PolygonShape();\n      p.SetAsBox(shape.width / 2, shape.height / 2);\n      fix.shape = p;\n      break;\n    case 'circle':\n      fix.shape = new b2CircleShape(shape.radius);\n      break;\n    case 'polygon':\n      p = new b2PolygonShape();\n      p.Set(shape.vertices);\n      fix.shape = p;\n      break;\n    case 'edge':\n      const e = new b2EdgeShape();\n      e.Set(shape.v1, shape.v2);\n      fix.shape = e;\n      break;\n    case 'capsule':\n      p = new b2PolygonShape();\n      p.Set(createCapsule(shape.width, shape.height, shape.segments ?? 8));\n      break;\n    default:\n      throw new Error(`Shape ${(shape as any).shape} not supported (yet)`);\n  }\n\n  return fix;\n}\n\nfunction applyFixtures(body: b2Body, fix: b2FixtureDef) {\n  // remove all existing fixtures\n  for (let fix = body.GetFixtureList(); !!fix; fix = fix.GetNext()) {\n    body.DestroyFixture(fix);\n  }\n  body.CreateFixture(fix);\n}\n\nconst manageWorldsEffect = makeEffect(\n  [components.WorldConfig],\n  (entity, game) => {\n    const config = entity.get(components.WorldConfig);\n    const world = new b2World(config.gravity);\n    game.globals.resolve('physicsWorld', world);\n    const contactListener = new ContactListener();\n    world.SetContactListener(contactListener);\n    game.globals.resolve('physicsContacts', contactListener);\n  },\n  (_, game) => {\n    game.globals.remove('physicsWorld');\n    game.globals.remove('physicsContacts');\n  }\n);\n\nconst manageBodiesEffect = makeEffect(\n  [components.BodyConfig, components.Transform],\n  function* (entity, game) {\n    const bodyConfig = entity.get(components.BodyConfig);\n    const transform = entity.get(components.Transform);\n    const world = yield game.globals.load('physicsWorld');\n\n    const b = world.CreateBody();\n    const { x, y, angle } = transform;\n    b.SetAngle(angle);\n    b.SetPositionXY(x, y);\n\n    assignBodyConfig(b, bodyConfig, entity.id);\n    applyFixtures(b, createFixtureDef(bodyConfig, entity.id));\n\n    game.add(entity.id, components.Body, { value: b });\n  },\n  function* (entity, game) {\n    const body = entity.get(components.Body);\n    if (body?.value) {\n      const world = yield game.globals.load('physicsWorld');\n      world.DestroyBody(body.value);\n    }\n    game.remove(entity.id, components.Body);\n  }\n);\n\nconst manageContactsCacheEffect = makeEffect(\n  [components.Contacts],\n  (entity, game) => {\n    game.add(entity.id, components.ContactsCache);\n  },\n  (entity, game) => {\n    game.remove(entity.id, components.ContactsCache);\n  }\n);\n\nconst subscribeContactsCacheEffect = makeEffect(\n  [components.ContactsCache],\n  function* (entity, game) {\n    const contactsCache = entity.get(components.ContactsCache);\n\n    const contactListener = yield game.globals.load('physicsContacts');\n\n    contactListener.subscribe(entity.id, contactsCache);\n  },\n  function* (entity, game) {\n    const contactListener = yield game.globals.load('physicsContacts');\n    contactListener.unsubscribe(entity.id);\n  }\n);\n\nconst updateBodiesSystem = makeSystem(\n  [changed(components.BodyConfig), components.Body],\n  (ent) => {\n    const body = ent.get(components.Body);\n    const config = ent.get(components.BodyConfig);\n\n    assignBodyConfig(body.value, config, ent.id);\n    applyFixtures(body.value, createFixtureDef(config, ent.id));\n    body.updated = true;\n  }\n);\n\nconst resetContactsSystem = makeSystem([components.Contacts], (ent) => {\n  const contacts = ent.get(components.Contacts);\n  contacts.began.length = 0;\n  contacts.ended.length = 0;\n  contacts.updated = true;\n});\n\nconst stepWorldRunner = (game: Game) => {\n  let simulate: () => void;\n  game.globals.load('physicsWorld').then((world) => {\n    simulate = () => {\n      world.Step(1 / 60.0, 8, 3);\n    };\n    game.on('step', simulate);\n  });\n\n  return () => {\n    game.off('step', simulate);\n  };\n};\n\nconst updateTransformsSystem = makeSystem(\n  [components.Body, components.Transform],\n  (ent) => {\n    const body = ent.get(components.Body);\n\n    const pos = body.value.GetPosition();\n\n    ent.get(components.Transform).update((transform) => {\n      transform.x = pos.x;\n      transform.y = pos.y;\n      transform.angle = body.value.GetAngle();\n    });\n  }\n);\n\nconst updateContactsSystem = makeSystem(\n  [changed(components.ContactsCache), components.Contacts],\n  (ent) => {\n    const cache = ent.get(components.ContactsCache);\n    const contacts = ent.get(components.Contacts);\n\n    let c: EntityContact;\n    for (c of cache.began.values()) {\n      contacts.began.push(c);\n      contacts.current.push(c);\n    }\n    for (c of cache.ended.values()) {\n      contacts.current.splice(contacts.current.indexOf(c), 1);\n      contacts.ended.push(c);\n    }\n\n    contacts.updated = true;\n\n    cache.began.clear();\n    cache.ended.clear();\n  }\n);\n\nexport const systems = compose(\n  manageWorldsEffect,\n  manageBodiesEffect,\n  manageContactsCacheEffect,\n  subscribeContactsCacheEffect,\n  updateBodiesSystem,\n  resetContactsSystem,\n  stepWorldRunner,\n  updateTransformsSystem,\n  updateContactsSystem\n);\n","import { vecScale } from 'math2d';\n\nexport function createCapsule(width: number, height: number, segments: number) {\n  const radius = width / 2;\n  const rectHeight = height - width;\n  const c0 = { x: -radius, y: -rectHeight / 2 };\n  const c1 = { x: radius, y: -rectHeight / 2 };\n  const c2 = { x: radius, y: rectHeight / 2 };\n  const c3 = { x: -radius, y: rectHeight / 2 };\n  const arc0 = new Array(segments).fill(null).map((_, i) => {\n    const angle = -(Math.PI / 2) + (Math.PI / segments) * i;\n\n    return vecScale(\n      {\n        x: Math.cos(angle),\n        y: Math.sin(angle),\n      },\n      radius\n    );\n  });\n  const arc1 = new Array(segments).fill(null).map((_, i) => {\n    const angle = Math.PI / 2 + (Math.PI / segments) * i;\n\n    return vecScale(\n      {\n        x: Math.cos(angle),\n        y: Math.sin(angle),\n      },\n      radius\n    );\n  });\n  return [c0, ...arc0, c1, c2, ...arc1, c3];\n}\n","import { Game } from '0g';\nimport {\n  Asteroid,\n  Bullet,\n  ColliderTag,\n  Damageable,\n  Player,\n  SpriteConfig,\n} from './components';\nimport {\n  Transform,\n  BodyConfig,\n  Contacts,\n  WorldConfig,\n} from '../common/box2d/components';\n\nexport function playerPrefab(game: Game, { x, y }: { x: number; y: number }) {\n  const id = game.create();\n  game.add(id, Player);\n  game.add(id, SpriteConfig, {\n    path: 'm -2 -2 l 4 2 l -4 2 l 1 -2 l -1 -2',\n  });\n  game.add(id, Transform, { x, y });\n  game.add(id, BodyConfig, {\n    shape: {\n      shape: 'polygon',\n      vertices: [\n        { x: -2, y: -2 },\n        { x: 2, y: 0 },\n        { x: -2, y: 2 },\n        { x: -1, y: 0 },\n      ],\n    },\n    angularDamping: 0.01,\n    linearDamping: 0.01,\n    restitution: 0.5,\n  });\n  game.add(id, Contacts);\n  game.add(id, Damageable, { damageFrom: ['asteroid'] });\n  game.add(id, ColliderTag, { group: 'player' });\n  return id;\n}\n\n// 3 sizes x 3 variants\nconst asteroidPaths = [\n  [\n    'm 0 -1 l 1 1 l 0 1 l -2 0 l 1 -2',\n    'm 0 -1 l 1 1 l -1 1 l -1 -1 l 1 -1',\n    'm 0 -1 l 1 1 l -1 1 l 0 -1 l 0 -1',\n  ],\n  [\n    'm 0.5 -2.5 l 2 1 l 0 2 l -1 1 l -1 0 l -1 1 l -2 -1 l 1 -3 l 2 -1',\n    'm -0.5 -2.5 l 2 1 l 1 2 l -1 2 l -3 0 l -1 -2 l 1 -1 l -1 -1 l 2 -1',\n    'm 0.5 -2.5 l 2 2 l -1 1 l 0 1 l -2 1 l -2 -2 l 0 -1 l 1 -1 l 2 -1',\n  ],\n  [\n    'm 0 -4 l 3 1 l 0 1 l -1 1 l 2 1 l 0 2 l -3 2 l -3 -2 l -1 1 l -1 -3 l 1 -3 l 3 -1',\n    'm -2 -3 l 3 -1 l 2 1 l 1 1 l -1 2 l -1 3 l -3 1 l -1 -2 l -1 0 l -1 -3 l 2 -1 l 0 -1',\n    'm -3 -3 l 5 -1 l 2 1 l 0 3 l -1 1 l -2 2 l -3 1 l -1 -1 l 0 -2 l 1 -1 l -1 -1 l 0 -2',\n  ],\n];\nconst asteroidSizes = [1, 3, 5];\n\nexport function asteroidPrefab(\n  game: Game,\n  { size, x, y }: { size: number; x: number; y: number }\n) {\n  const id = game.create();\n  const variant = Math.floor(Math.random() * 3);\n  game.add(id, Asteroid, {\n    size,\n    variant,\n  });\n  game.add(id, SpriteConfig, {\n    path: asteroidPaths[size][variant],\n  });\n  game.add(id, Transform, { x, y });\n  game.add(id, BodyConfig, {\n    shape: {\n      shape: 'circle',\n      radius: asteroidSizes[size],\n    },\n    restitution: 0.5,\n    angularDamping: 0,\n    linearDamping: 0,\n    density: 0.5,\n  });\n  game.add(id, Contacts);\n  game.add(id, Damageable, {\n    invulnerableFrames: 0,\n    damageFrom: ['bullet', 'player'],\n  });\n  game.add(id, ColliderTag, { group: 'asteroid' });\n  return id;\n}\n\nexport function bulletPrefab(\n  game: Game,\n  { x, y, angle }: { x: number; y: number; angle: number }\n) {\n  const id = game.create();\n  game.add(id, Bullet);\n  game.add(id, SpriteConfig, {\n    path: 'M 0 0 L 1 0',\n  });\n  game.add(id, Transform, { x, y, angle });\n  game.add(id, BodyConfig, {\n    shape: {\n      shape: 'rectangle',\n      width: 0.5,\n      height: 1,\n    },\n    bullet: true,\n    sensor: true,\n  });\n  game.add(id, Contacts);\n  game.add(id, ColliderTag, { group: 'bullet' });\n  console.log('made bullet', id);\n  (window as any).bulletId = id;\n  return id;\n}\n\nexport function worldPrefab(game: Game) {\n  const id = game.create();\n  game.add(id, WorldConfig, { gravity: { x: 0, y: 0 } });\n  return id;\n}\n","export function createSVGElement<Tag extends keyof SVGElementTagNameMap>(\n  tagName: Tag\n) {\n  return document.createElementNS('http://www.w3.org/2000/svg', tagName);\n}\n","import { any, changed, compose, makeEffect, makeSystem } from '0g';\nimport { vecNormalize, vecScale } from 'math2d';\nimport { Body, Contacts, Transform } from '../common/box2d/components';\nimport {\n  Asteroid,\n  Bullet,\n  ColliderTag,\n  Damageable,\n  Player,\n  Sprite,\n  SpriteConfig,\n} from './components';\nimport { asteroidPrefab, bulletPrefab } from './prefabs';\nimport { createSVGElement } from './utils';\n\nconst createSpriteEffect = makeEffect(\n  [SpriteConfig],\n  function* (entity, game) {\n    const element = createSVGElement('g');\n    const pathEl = createSVGElement('path');\n    const { path, stroke, dashGap } = entity.get(SpriteConfig);\n    pathEl.setAttribute('d', path);\n    pathEl.setAttribute('stroke', stroke);\n    pathEl.setAttribute('stroke-width', '1px');\n    pathEl.setAttribute('vector-effect', 'non-scaling-stroke');\n    pathEl.setAttribute(\n      'stroke-dasharray',\n      dashGap ? dashGap.toString() : 'none'\n    );\n    element.appendChild(pathEl);\n\n    const root = yield game.globals.load('root');\n\n    root.appendChild(element);\n\n    game.add(entity.id, Sprite, { element, path: pathEl });\n  },\n  function* (entity, game) {\n    const sprite = entity.get(Sprite);\n    if (sprite) {\n      const { element } = sprite;\n      const root = yield game.globals.load('root');\n      game.remove(entity.id, Sprite);\n      root.removeChild(element);\n    }\n  }\n);\n\nconst updateSpriteSystem = makeSystem(\n  [changed(SpriteConfig), Sprite],\n  (entity) => {\n    const { path, stroke, dashGap } = entity.get(SpriteConfig);\n    const { path: pathEl } = entity.get(Sprite);\n    pathEl.setAttribute('d', path);\n    pathEl.setAttribute('stroke', stroke);\n    pathEl.setAttribute(\n      'stroke-dasharray',\n      dashGap ? dashGap.toString() : 'none'\n    );\n  }\n);\n\nconst transformSpriteSystem = makeSystem(\n  [changed(Transform), Sprite],\n  (entity) => {\n    const { element } = entity.get(Sprite);\n    const { x, y, angle } = entity.get(Transform);\n    element.setAttribute(\n      'transform',\n      `translate(${x}, ${y}) rotate(${angle * (180 / Math.PI)})`\n    );\n  }\n);\n\nconst asteroidInitialSpinEffect = makeEffect([Asteroid, Body], (entity) => {\n  entity.get(Body).value.SetAngularVelocity(Math.random() - 0.5);\n});\n\nconst bulletInitialVelocityEffect = makeEffect(\n  [Bullet, Transform, Body],\n  (entity) => {\n    // get forward direction\n    const angle = entity.get(Transform).angle;\n    const forward = { x: Math.cos(angle), y: Math.sin(angle) };\n    entity\n      .get(Body)\n      .value.ApplyLinearImpulseToCenter(\n        vecScale(forward, entity.get(Bullet).speed)\n      );\n  }\n);\n\nconst playerMovementSystem = makeSystem(\n  [Player, Body, Transform],\n  (entity, game) => {\n    const keyboard = game.globals.immediate('keyboard')!;\n\n    let rotation = 0;\n    if (keyboard.getKeyPressed('a')) {\n      rotation -= 1;\n    }\n    if (keyboard.getKeyPressed('d')) {\n      rotation += 1;\n    }\n\n    let thrust = 0;\n    if (keyboard.getKeyPressed('w')) {\n      thrust += 1;\n    }\n    if (keyboard.getKeyPressed('s')) {\n      thrust -= 1;\n    }\n\n    const { rotateSpeed, thrustForce } = entity.get(Player);\n\n    const body = entity.get(Body);\n    body.value.SetAngularVelocity(rotation * rotateSpeed);\n    // get forward for thrust\n    const angle = entity.get(Transform).angle;\n    const forward = { x: Math.cos(angle), y: Math.sin(angle) };\n    body.value.ApplyLinearImpulseToCenter(\n      vecScale(forward, thrust * thrustForce),\n      true\n    );\n  }\n);\n\nconst damageSystem = makeSystem(\n  [Damageable, changed(Contacts)],\n  (entity, game) => {\n    const contacts = entity.get(Contacts);\n    const damageable = entity.get(Damageable);\n    let tookDamage = false;\n    for (const contact of contacts.began) {\n      if (!contact.otherId) continue;\n\n      const other = game.get(contact.otherId);\n      const colliderTag = other?.get(ColliderTag);\n\n      if (!colliderTag) continue;\n\n      tookDamage =\n        tookDamage || damageable.damageFrom.includes(colliderTag.group);\n    }\n    if (tookDamage) {\n      damageable.addDamage();\n    }\n  }\n);\n\nconst damageCooldownSystem = makeSystem([Damageable], (entity) => {\n  entity.get(Damageable).tickInvulnerability();\n});\n\nconst shootSystem = makeSystem([Player, Transform], (entity, game) => {\n  const keyboard = game.globals.immediate('keyboard')!;\n\n  if (keyboard.getKeyDown(' ') || keyboard.getKeyDown('Control')) {\n    const { x, y, angle } = entity.get(Transform);\n    bulletPrefab(game, { x, y, angle });\n  }\n});\n\nconst playerDestroySystem = makeSystem(\n  [Player, changed(Damageable)],\n  (entity, game) => {\n    const damageable = entity.get(Damageable);\n    if (damageable.dead) {\n      game.destroy(entity.id);\n    }\n  }\n);\n\nconst asteroidDestroySystem = makeSystem(\n  [Asteroid, changed(Damageable), Transform],\n  (entity, game) => {\n    const damageable = entity.get(Damageable);\n    if (damageable.dead) {\n      const { x, y } = entity.get(Transform);\n      const { size } = entity.get(Asteroid);\n\n      if (size > 0) {\n        // create more!\n        for (let i = 0; i < 2; i++) {\n          asteroidPrefab(game, {\n            size: size - 1,\n            x: x + Math.random() - 0.5,\n            y: y + Math.random() - 0.5,\n          });\n        }\n      }\n\n      game.destroy(entity.id);\n    }\n  }\n);\n\nconst bulletDestroySystem = makeSystem(\n  [Bullet, changed(Contacts)],\n  (entity, game) => {\n    for (const contact of entity.get(Contacts).began) {\n      if (!contact.otherId) continue;\n\n      const other = game.get(contact.otherId);\n      const colliderTag = other?.get(ColliderTag);\n\n      if (colliderTag?.group !== 'asteroid') continue;\n\n      game.destroy(entity.id);\n    }\n  }\n);\n\nconst asteroidRecoilSystem = makeSystem(\n  [Asteroid, Body, Transform, changed(Contacts)],\n  (entity, game) => {\n    const transform = entity.get(Transform);\n    for (const contact of entity.get(Contacts).began) {\n      if (!contact.otherId) continue;\n\n      const other = game.get(contact.otherId);\n\n      if (!other) continue;\n\n      const colliderTag = other.get(ColliderTag);\n\n      if (colliderTag?.group !== 'bullet') continue;\n\n      const otherTransform = other.get(Transform);\n\n      if (!otherTransform) continue;\n\n      // a rough collision normal calculation using difference\n      // of both objects' positions.\n      const direction = {\n        x: transform.x - otherTransform.x,\n        y: transform.y - otherTransform.y,\n      };\n      const normal = vecNormalize(direction);\n\n      const body = entity.get(Body);\n      body.value.ApplyLinearImpulseToCenter(\n        vecScale(normal, body.value.GetMass()),\n        true\n      );\n    }\n  }\n);\n\nconst damageVisualizerSystem = makeSystem(\n  [changed(Damageable), SpriteConfig],\n  (entity) => {\n    const { health, maxHealth } = entity.get(Damageable);\n    const gap =\n      health === maxHealth ? 0 : Math.round((health / maxHealth) * 10);\n    entity.get(SpriteConfig).update((self) => (self.dashGap = gap));\n  }\n);\n\nconst cleanupBulletsSystem = makeSystem(\n  [Bullet, changed(Transform)],\n  (entity, game) => {\n    const { x, y } = entity.get(Transform);\n    if (x < -10 || x > 110 || y < -10 || y > 110) {\n      game.destroy(entity.id);\n    }\n  }\n);\n\nfunction wrap(v: number, buffer = 2) {\n  const size = 100 + buffer * 2;\n  return v > 100 + buffer ? v - size : v < -buffer ? v + size : v;\n}\nconst wrapObjectsSystem = makeSystem(\n  [any(Player, Asteroid), Transform, Body],\n  (entity, game) => {\n    const transform = entity.get(Transform);\n    const wrappedX = wrap(transform.x);\n    const wrappedY = wrap(transform.y);\n\n    if (wrappedX !== transform.x || wrappedY !== transform.y) {\n      const body = entity.get(Body);\n      body.value.SetPositionXY(wrappedX, wrappedY);\n    }\n  }\n);\n\nexport const systems = compose(\n  createSpriteEffect,\n  updateSpriteSystem,\n  transformSpriteSystem,\n  asteroidInitialSpinEffect,\n  bulletInitialVelocityEffect,\n  playerMovementSystem,\n  damageSystem,\n  damageCooldownSystem,\n  shootSystem,\n  playerDestroySystem,\n  asteroidDestroySystem,\n  bulletDestroySystem,\n  damageVisualizerSystem,\n  cleanupBulletsSystem,\n  wrapObjectsSystem,\n  asteroidRecoilSystem\n);\n","export type KeyboardKey =\n  | 'Alt'\n  | 'Control'\n  | 'Shift'\n  | 'Enter'\n  | 'Tab'\n  | ' '\n  | 'ArrowDown'\n  | 'ArrowLeft'\n  | 'ArrowUp'\n  | 'ArrowRight'\n  | 'Escape'\n  | 'w'\n  | 'a'\n  | 's'\n  | 'd';\n\nexport class Keyboard {\n  private keysPressed = new Set<string>();\n  private keysDown = new Set<string>();\n  private keysUp = new Set<string>();\n\n  constructor() {\n    window.addEventListener('keydown', this.handleKeyDown);\n    window.addEventListener('keyup', this.handleKeyUp);\n  }\n\n  private handleKeyDown = (ev: KeyboardEvent) => {\n    const key = ev.key;\n    // avoid key-repeat triggering?\n    if (!this.keysPressed.has(key)) {\n      this.keysPressed.add(key);\n      this.keysDown.add(key);\n    }\n  };\n\n  private handleKeyUp = (ev: KeyboardEvent) => {\n    const key = ev.key;\n    this.keysPressed.delete(ev.key);\n    this.keysUp.add(key);\n  };\n\n  getKeyPressed = (key: KeyboardKey) => {\n    return this.keysPressed.has(key);\n  };\n\n  getKeyDown = (key: KeyboardKey) => {\n    return this.keysDown.has(key);\n  };\n\n  getKeyUp = (key: KeyboardKey) => {\n    return this.keysUp.has(key);\n  };\n\n  getAllPressedKeys = () => {\n    return this.keysPressed;\n  };\n\n  frame = () => {\n    this.keysDown.clear();\n    this.keysUp.clear();\n  };\n}\n\nexport const keyboard = new Keyboard();\n","export class Pointer {\n  private _position: { x: number; y: number } | null = null;\n  private _primaryPressed = false;\n  private _primaryDown = false;\n  private _primaryUp = false;\n  private _secondaryPressed = false;\n  private _secondaryDown = false;\n  private _secondaryUp = false;\n\n  constructor() {\n    window.addEventListener('pointerdown', this.handlePointerDownEvents);\n    window.addEventListener('pointerup', this.handlePointerDownEvents);\n    window.addEventListener('pointermove', this.handlePointerMoveEvent);\n  }\n\n  private handlePointerDownEvents = (ev: PointerEvent) => {\n    if (!this._position) {\n      this._position = { x: ev.clientX, y: ev.clientY };\n    } else {\n      this._position.x = ev.clientX;\n      this._position.y = ev.clientY;\n    }\n\n    if (ev.type === 'pointerdown') {\n      if (ev.isPrimary) {\n        this._primaryDown = true;\n        this._primaryPressed = true;\n      } else {\n        this._secondaryDown = true;\n        this._secondaryPressed = true;\n      }\n    } else if (ev.type === 'pointerup') {\n      if (ev.isPrimary) {\n        this._primaryUp = true;\n        this._primaryPressed = false;\n      } else {\n        this._secondaryUp = true;\n        this._secondaryPressed = false;\n      }\n    }\n  };\n\n  private handlePointerMoveEvent = (ev: PointerEvent) => {\n    this._position = { x: ev.clientX, y: ev.clientY };\n  };\n\n  /** Position might be null - that means no pointer was detected */\n  get position() {\n    return this._position;\n  }\n\n  get primaryPressed() {\n    return this._primaryPressed;\n  }\n\n  get primaryDown() {\n    return this._primaryDown;\n  }\n\n  get primaryUp() {\n    return this._primaryUp;\n  }\n\n  get secondaryPressed() {\n    return this._secondaryPressed;\n  }\n\n  get secondaryDown() {\n    return this._secondaryDown;\n  }\n\n  get secondaryUp() {\n    return this._secondaryUp;\n  }\n\n  frame = () => {\n    this._primaryDown = false;\n    this._primaryUp = false;\n    this._secondaryDown = false;\n    this._secondaryUp = false;\n  };\n}\n\nexport const pointer = new Pointer();\n","import { Game } from '0g';\nimport * as gameComponents from './components';\nimport * as box2dComponents from '../common/box2d/components';\nimport { systems as box2dSystems } from '../common/box2d/systems';\nimport { systems } from './systems';\nimport { createSVGElement } from './utils';\nimport { asteroidPrefab, playerPrefab, worldPrefab } from './prefabs';\nimport { Keyboard, keyboard } from '../common/input/keyboard';\nimport { Pointer, pointer } from '../common/input/pointer';\n\nconst game = new Game({\n  components: [\n    ...Object.values(gameComponents),\n    ...Object.values(box2dComponents),\n  ],\n  systems: [box2dSystems, systems],\n});\n\ngame.globals.resolve('keyboard', keyboard);\ngame.on('stepComplete', keyboard.frame);\ngame.globals.resolve('pointer', pointer);\ngame.on('stepComplete', pointer.frame);\n\nconst root = createSVGElement('svg');\nroot.setAttribute('viewBox', '0 0 100 100');\ngame.globals.resolve('root', root);\n\n// setup initial game entities\nworldPrefab(game);\nplayerPrefab(game, { x: 50, y: 50 });\nfor (let i = 0; i < 4; i++) {\n  asteroidPrefab(game, {\n    size: 2,\n    x: Math.random() * 100,\n    y: Math.random() * 100,\n  });\n}\n\ndeclare module '0g' {\n  interface GameResources {\n    root: SVGSVGElement;\n    keyboard: Keyboard;\n    pointer: Pointer;\n  }\n}\n\nexport const spaceGameRoot = root;\nexport const spaceGame = game;\n\n// @ts-ignore\nwindow.game = game;\n","import * as React from 'react';\nimport { Editor } from '@0g/editor';\nimport { spaceGame, spaceGameRoot } from './spaceGame';\n\nexport function SpaceGameRoot() {\n  const ref = React.useRef<HTMLDivElement>(null);\n\n  React.useEffect(() => {\n    const el = ref.current;\n    if (!el) return;\n    el.appendChild(spaceGameRoot);\n\n    let raf = 0;\n    const loop = () => {\n      raf = requestAnimationFrame(loop);\n      spaceGame.step(1000 / 60);\n    };\n\n    loop();\n\n    return () => {\n      el.removeChild(spaceGameRoot);\n      cancelAnimationFrame(raf);\n    };\n  }, [ref]);\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        width: '100%',\n      }}\n    >\n      <div\n        css={{\n          width: '80vmin',\n          height: '80vmin',\n          margin: 'auto',\n        }}\n        ref={ref}\n      />\n      <Editor game={spaceGame} />\n    </div>\n  );\n}\n","import * as React from 'react';\nimport { animated, useSpring } from '@react-spring/web';\nimport { SpaceGameRoot } from '../demos/space/SpaceGameRoot';\n\nconst SCROLL_THRESHOLD = 500;\n\nexport function HomePage() {\n  const [{ scrollTop }, set] = useSpring(() => ({\n    scrollTop: 0,\n  }));\n\n  React.useEffect(() => {\n    const handleScroll = () => {\n      set({ scrollTop: window.scrollY });\n    };\n    window.addEventListener('scroll', handleScroll);\n    return () => {\n      window.removeEventListener('scroll', handleScroll);\n    };\n  }, [set]);\n\n  return (\n    <article\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n      }}\n    >\n      <animated.div\n        css={(theme) => ({\n          position: 'fixed',\n          left: '50%',\n          textAlign: 'center',\n          color: theme.colors.gray,\n          zIndex: -1,\n          transform: 'translateX(-50%)',\n        })}\n        style={\n          {\n            opacity: scrollTop.to((v) =>\n              Math.max(0.5, (SCROLL_THRESHOLD - v) / SCROLL_THRESHOLD)\n            ),\n          } as any\n        }\n      >\n        <h1\n          css={(theme) => ({\n            fontFamily: theme.fonts.heading,\n            fontSize: 120,\n          })}\n        >\n          0G\n        </h1>\n        <animated.section\n          css={(theme) => ({ padding: theme.space[2], marginTop: 240 })}\n          style={\n            {\n              opacity: scrollTop.to(\n                (v) => (SCROLL_THRESHOLD - v) / SCROLL_THRESHOLD\n              ),\n            } as any\n          }\n        >\n          <p>The weightless game framework for TypeScript.</p>\n        </animated.section>\n      </animated.div>\n      <SpaceGameRoot />\n      <section\n        css={{\n          maxWidth: 640,\n        }}\n      >\n        <p>\n          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do\n          eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad\n          minim veniam, quis nostrud exercitation ullamco laboris nisi ut\n          aliquip ex ea commodo consequat. Duis aute irure dolor in\n          reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla\n          pariatur. Excepteur sint occaecat cupidatat non proident, sunt in\n          culpa qui officia deserunt mollit anim id est laborum.\n        </p>\n        <p>\n          Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do\n          eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad\n          minim veniam, quis nostrud exercitation ullamco laboris nisi ut\n          aliquip ex ea commodo consequat. Duis aute irure dolor in\n          reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla\n          pariatur. Excepteur sint occaecat cupidatat non proident, sunt in\n          culpa qui officia deserunt mollit anim id est laborum.\n        </p>\n      </section>\n    </article>\n  );\n}\n","import { Theme } from '@emotion/react';\n\nexport const theme: Theme = {\n  colors: {\n    background: '#202020',\n    text: '#fff',\n    gray: '#606070',\n    textInverse: '#202020',\n    backgroundInverse: '#fff',\n  },\n  space: [0, 4, 8, 16, 32, 64, 128, 256],\n  fonts: {\n    body: 'Menlo, monospace',\n    heading: '\"Major Mono Display\", monospace',\n  },\n  radius: {\n    control: 8,\n    surface: 16,\n  },\n  focusRing: {\n    primary: `0 0 0 2px #202020, 0 0 0 4px #fff`,\n  },\n};\n\ndeclare module '@emotion/react' {\n  export interface Theme {\n    colors: {\n      background: string;\n      text: string;\n      gray: string;\n      textInverse: string;\n      backgroundInverse: string;\n    };\n    space: number[];\n    fonts: {\n      body: string;\n      heading: string;\n    };\n    radius: {\n      control: number;\n      surface: number;\n    };\n    focusRing: {\n      primary: string;\n    };\n  }\n}\n","import React from 'react';\nimport { Route, Router } from 'wouter';\nimport { Header } from './components/Header';\nimport { HomePage } from './pages/HomePage';\nimport { ThemeProvider } from '@emotion/react';\nimport { theme } from './theme';\n\nfunction App() {\n  return (\n    <Router base={process.env.PUBLIC_URL}>\n      <ThemeProvider theme={theme}>\n        <div className=\"App\">\n          <Header />\n          <Route path=\"/\">\n            <HomePage />\n          </Route>\n        </div>\n      </ThemeProvider>\n    </Router>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}